!function(t,i){if("object"==typeof exports&&"object"==typeof module)module.exports=i();else if("function"==typeof define&&define.amd)define([],i);else{var n,e=i();for(n in e)("object"==typeof exports?exports:t)[n]=e[n]}}("undefined"!=typeof self?self:this,(function(){return i={0:function(t,i,n){"use strict";function e(t){return"number"==typeof t}function r(t){return"string"==typeof t}function s(t){return"boolean"==typeof t}function o(t){return void 0===t}function u(t){return null!==t&&t instanceof Object}function c(t){return"function"==typeof t}function h(t){return t instanceof Array}n.d(i,"d",(function(){return e})),n.d(i,"f",(function(){return r})),n.d(i,"b",(function(){return s})),n.d(i,"g",(function(){return o})),n.d(i,"e",(function(){return u})),n.d(i,"c",(function(){return c})),n.d(i,"a",(function(){return h}))},23:function(t,i,n){"use strict";function e(t){return t}n.r(i);var r="zm.lv.ssg",s="zm.lv.pss",o="/liveroom/send_end_join_live",u=e,c=e,h="/liveroom/send_invite_join_live",f=e,l=e,v="/liveroom/send_join_live_result",a=e,d=e,b="/liveroom/send_request_join_live",_=e,m=e,j={code:1002014,msg:"room not exist"},p={code:1002099,msg:"room inner error"},y=n(0),O=(Object.defineProperty(q.prototype,"u",{get:function(){return this.h.reporter},enumerable:!1,configurable:!0}),q.prototype.resetLiveHandler=function(){this.joinLiveCallbackMap={},this.joinLiveRequestMap={}},q.prototype.getSignalCmdContent=function(t,i,n){return t={request_id:t,room_id:this.room.roomID,from_userid:this.h.idName,from_username:this.h.nickName,to_userid:i},null!=n&&(t.result=n),JSON.stringify(t)},q.prototype.requestJoinLive=function(t,i,n,e){var r,s=this.h.getRequestId(),o=this.getSignalCmdContent(s,t);return null!=e&&(this.u.spanSetAttributes({key:b,par:null==(r=this.room)?void 0:r.roomID},{request_id:m(s)}),this.joinLiveCallbackMap[s]=e,this.sendSignalCmd(1001,o,t,i,n),!0)},q.prototype.sendSignalCmd=function(t,i,n,e,s){var o=this;this.room.isLogin()?((this.h.useNetAgent?this.liveRoomHandler:this.service).sendSignalCmd({sub_cmd:t,signal_msg:i,dest_id_name:[n]},(function(t){e&&e(t.header.seq)}),(function(t){var i=p;t.header&&t.body?s&&s(o.rtm.getServerError(t.body.err_code),t.header.seq):(t.code&&t.msg&&(i=t),s&&s(i,0))}),this.room),this.v.info(r+" call success"+t)):this.v.error(r+" state error")},q.prototype.inviteJoinLive=function(t,i,n,e){var r,s=this.h.getRequestId(),o=this.getSignalCmdContent(s,t);return null!=e&&(this.u.spanSetAttributes({key:h,par:null==(r=this.room)?void 0:r.roomID},{request_id:l(s)}),this.joinLiveCallbackMap[s]=e,this.sendSignalCmd(1003,o,t,i,n),!0)},q.prototype.endJoinLive=function(t,i,n){var e,r=this.h.getRequestId(),s=this.getSignalCmdContent(r,t);return this.u.spanSetAttributes({key:o,par:null==(e=this.room)?void 0:e.roomID},{request_id:c(r)}),this.sendSignalCmd(1004,s,t,i,n),!0},q.prototype.respondJoinLive=function(t,i,n,e){var r=this.joinLiveRequestMap[t];if(!r)return this.v.info("zm.lv.rjl no dest id name"),!1;this.u.spanSetAttributes({key:v,par:null==(s=this.room)?void 0:s.roomID},{to_user_id:a(r)});var s=0;i=this.getSignalCmdContent(t,r,s=!0===i?1:s);return this.sendSignalCmd(1002,i,r,n,e),delete this.joinLiveRequestMap[t],!0},q.prototype.handlePushSignalMsg=function(t){var i=JSON.parse(t.body.signal_msg);switch(this.v.info(s+" hpsm= ",i),t.body.sub_cmd){case 11001:this.handlePushJoinLiveRequestMsg(i);break;case 11002:this.handlePushJoinLiveResultMsg(i);break;case 11003:this.handlePushJoinLiveInviteMsg(i);break;case 11004:this.handlePushJoinLiveStopMsg(i)}},q.prototype.handlePushJoinLiveRequestMsg=function(t){var i,n=t.request_id;Object(y.f)(n)?(i=t.from_userid,Object(y.f)(i)?(this.joinLiveRequestMap[n]=i,this.onRecvJoinLiveRequest(n,t.from_userid,t.from_username,t.room_id),this.v.info(s+" onRecvJoinLiveRequest "+i)):this.v.error(s+" no from user")):this.v.error(s+" no requestId")},q.prototype.onRecvJoinLiveRequest=function(t,i,n,e){this.h.actionListener("recvJoinLiveRequest",t,i,n,e)},q.prototype.handlePushJoinLiveInviteMsg=function(t){var i,n=t.request_id;Object(y.f)(n)?(i=t.from_userid,Object(y.f)(i)?(this.joinLiveRequestMap[n]=i,this.onRecvInviteJoinLiveRequest(n,t.from_userid,t.from_username,t.room_id),this.v.info(s+" onRecvInviteJoinLiveRequest "+i)):this.v.error(s+" no from user")):this.v.error(s+"no requestId")},q.prototype.onRecvInviteJoinLiveRequest=function(t,i,n,e){this.h.actionListener("recvInviteJoinLiveRequest",t,i,n,e)},q.prototype.handlePushJoinLiveResultMsg=function(t){var i,n,e=t.request_id;Object(y.f)(e)?null==(i=t.result)?this.v.info(s+" no result"):(i=1==i,this.joinLiveCallbackMap[e]&&((n=this.joinLiveCallbackMap[e])?(this.v.info(s+" joinLiveRequest/invite result "+i),delete this.joinLiveCallbackMap[e],n(i,t.from_userid,t.from_username)):this.v.info(s+" no callback"))):this.v.error(s+" no requestId")},q.prototype.handlePushJoinLiveStopMsg=function(t){var i=t.request_id;Object(y.f)(i)?(this.v.info(s+" onRecvEndJoinLiveCommand "+t.from_userid),this.onRecvEndJoinLiveCommand(i,t.from_userid,t.from_username,t.room_id)):this.v.error(s+" no requestId")},q.prototype.onRecvEndJoinLiveCommand=function(t,i,n,e){this.h.actionListener("recvEndJoinLiveCommand",t,i,n,e)},q);function q(t,i,n,e,r,s){this.v=t,this.h=i,this.service=n,this.liveRoomHandler=e,this.rtm=r,this.room=s,this.joinLiveCallbackMap={},this.joinLiveRequestMap={}}var g={requestJoinLive:function(t,i,n,e,r){var s=this,o=this.getMsgSpan(b,r||(null==(u=this.stateCenter.roomModulesList[0])?void 0:u.roomID),!0),u=this.getRoomModules(r)||this.stateCenter.roomModulesList[0];return u?(o.setAttributes({to_user_id:_(t)}),u.liveHandler.requestJoinLive(t,(function(t){o.end(),i(t)}),(function(t,i){s.stateCenter.reporter.setError(o,t),n(t,i)}),e)):(this.stateCenter.reporter.setError(o,j),n&&n(j,0),!1)},inviteJoinLive:function(t,i,n,e,r){var s=this,o=this.getMsgSpan(h,r||(null==(u=this.stateCenter.roomModulesList[0])?void 0:u.roomID),!0),u=this.getRoomModules(r)||this.stateCenter.roomModulesList[0];return u?(o.setAttributes({to_user_id:f(t)}),u.liveHandler.inviteJoinLive(t,(function(t){o.end(),i(t)}),(function(t,i){s.stateCenter.reporter.setError(o,t),n(t,i)}),e)):(this.stateCenter.reporter.setError(o,j),n&&n(j,0),!1)},endJoinLive:function(t,i,n,e){var r=this,s=this.getMsgSpan(o,e||(null==(c=this.stateCenter.roomModulesList[0])?void 0:c.roomID),!0),c=this.getRoomModules(e)||this.stateCenter.roomModulesList[0];return c?(s.setAttributes({to_user_id:u(t)}),c.liveHandler.endJoinLive(t,(function(t){s.end(),i(t)}),(function(t,i){r.stateCenter.reporter.setError(s,t),n(t,i)}))):(this.stateCenter.reporter.setError(s,j),n&&n(j,0),!1)},respondJoinLive:function(t,i,n,e,r){var s=this,o=this.getMsgSpan(v,r||(null==(u=this.stateCenter.roomModulesList[0])?void 0:u.roomID),!0),u=this.getRoomModules(r)||this.stateCenter.roomModulesList[0];return u?(o.setAttributes({request_id:d(t),join_result:i}),u.liveHandler.respondJoinLive(t,i,(function(t){o.end(),n(t)}),(function(t,i){s.stateCenter.reporter.setError(o,t),e(t,i)}))):(this.stateCenter.reporter.setError(o,j),e&&e(j,0),!1)}},J={handlePushSignalMsg:function(t){var i=null==(n=null==t?void 0:t.header)?void 0:n.room_id,n=this.stateCenter.roomModulesList.find((function(t){return t.roomID==i}));n?n.liveHandler.handlePushSignalMsg(t):this.logger.error("zm.sv.ps room no found ignore "+JSON.stringify(t))}},L={initLiveHandler:function(){this.liveHandler=new O(this.logger,this.stateCenter,this.service,this.liveRoomHandler,this.rtm,this)}};i.default={type:"live",install:function(t,i,n,e){for(var r in g)Object.defineProperty(t.prototype,r,{value:g[r],writable:!1});for(var r in J)Object.defineProperty(n.prototype,r,{value:J[r],writable:!1}),Object.defineProperty(e.prototype,r,{value:J[r],writable:!1});for(var r in L)Object.defineProperty(i.prototype,r,{value:L[r],writable:!1})}}}},n={},t.m=i,t.c=n,t.d=function(i,n,e){t.o(i,n)||Object.defineProperty(i,n,{enumerable:!0,get:e})},t.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},t.t=function(i,n){if(1&n&&(i=t(i)),8&n)return i;if(4&n&&"object"==typeof i&&i&&i.__esModule)return i;var e=Object.create(null);if(t.r(e),Object.defineProperty(e,"default",{enumerable:!0,value:i}),2&n&&"string"!=typeof i)for(var r in i)t.d(e,r,function(t){return i[t]}.bind(null,r));return e},t.n=function(i){var n=i&&i.__esModule?function(){return i.default}:function(){return i};return t.d(n,"a",n),n},t.o=function(t,i){return Object.prototype.hasOwnProperty.call(t,i)},t.p="",t(t.s=23);function t(e){var r;return(n[e]||(r=n[e]={i:e,l:!1,exports:{}},i[e].call(r.exports,r,r.exports,t),r.l=!0,r)).exports}var i,n}));