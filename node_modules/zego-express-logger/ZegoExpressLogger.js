!function(t,n){if("object"==typeof exports&&"object"==typeof module)module.exports=n(require("pako/lib/deflate"));else if("function"==typeof define&&define.amd)define(["pako/lib/deflate"],n);else{var i,e="object"==typeof exports?n(require("pako/lib/deflate")):n(t["pako/lib/deflate"]);for(i in e)("object"==typeof exports?exports:t)[i]=e[i]}}("undefined"!=typeof self?self:this,function(i){return e=[function(t,n){t.exports=i},,function(R,t,n){"use strict";n.r(t),n.d(t,"ZegoLogger",function(){return Bt}),n.d(t,"ZegoDataReport",function(){return W}),n.d(t,"createZegoWebSocket",function(){return M}),n.d(t,"LoggerStateCenter",function(){return C});e.getInstance=function(){return e.instance||(e.instance=new e).u(),e.instance},e.prototype.u=function(){},Object.defineProperty(e.prototype,"testEnvironment",{get:function(){return this.h},set:function(t){this.h=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"ENV",{get:function(){return this.v},set:function(t){this.v=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"debug",{get:function(){return this.g},set:function(t){this.g=t},enumerable:!1,configurable:!0}),e.instance=new e;var r,i,o,C=e;function e(){this.h=!0,this.v=0,this.g=!0}(t=b=b||{})[t.IE=0]="IE",t[t.FIREFOX=1]="FIREFOX",t[t.CHROME=2]="CHROME",t[t.SAFARI=3]="SAFARI",t[t.OPERA=4]="OPERA",t[t.WEIXIN=5]="WEIXIN",t[t.WEIXINMINI=6]="WEIXINMINI",t[t.UNKOWN=7]="UNKOWN",(b=r=r||{})[b.BROWSER=0]="BROWSER",b[b.WEIXINMINI=1]="WEIXINMINI",i=i||{},i[i.DEFAULT=0]="DEFAULT",(t=o=o||{})[t.DISABLE=0]="DISABLE",t[t.WEBSOCKET=1]="WEBSOCKET",t[t.HTTPS=2]="HTTPS";var s={DEBUG:0,INFO:1,WARN:2,ERROR:3,REPORT:99,DISABLE:100,debug:0,info:1,warn:2,error:3,report:99,disable:100},J=(0,u.prototype.init=function(){var n=this;this.O&&(this.readyState=0,this.O.onOpen(function(t){n.readyState=n.O.readyState,"function"==typeof n.onopen&&(n.onopen(t),n.O.onClose(function(t){n.readyState=n.O.readyState,"function"==typeof n.onclose&&n.onclose(t)}),n.O.onMessage(function(t){"function"==typeof n.onmessage&&n.onmessage(t)}))}),this.O.onError(function(t){n.readyState=n.O.readyState,"function"==typeof n.onerror&&n.onerror(t)}))},u.prototype.onopen=function(t){},u.prototype.onerror=function(t){},u.prototype.onclose=function(t){},u.prototype.onmessage=function(t){},u.prototype.send=function(t){this.O&&this.O.send({data:t})},u.prototype.close=function(){this.O&&this.O.close()},u);function u(t,n){this.url=t,this.readyState=3,this.init()}function M(t,n,i){return n%2===r.BROWSER?(n=t,(i=i)?i.createSocket(n,1):new WebSocket(n)):new J(t)}var L=function(){return(L=Object.assign||function(t){for(var n,i=1,e=arguments.length;i<e;i++)for(var r in n=arguments[i])Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r]);return t}).apply(this,arguments)},W=(c.prototype.newReport=function(t,n){this.dataStatistics[t]={event_time:Date.now(),time_consumed:0,seq:t,error:0,message:"success",event:n,events:[]}},c.prototype.addMsgExt=function(t,n){this.dataStatistics[t]?this.dataStatistics[t].msg_ext=n:console.warn("".concat(t," not exist"))},c.prototype.addMsgInfo=function(t,n){this.dataStatistics[t]?Object.assign(this.dataStatistics[t],n):console.warn("".concat(t," not exist"))},c.prototype.eventStart=function(t,n){this.dataStatistics[t]?null==this.dataStatistics[t].events?this.logger.warn("zd.es.0 no events"):this.dataStatistics[t].events.push({event:n,event_time:Date.now(),time_consumed:0}):this.logger.warn("zd.es.0 no seq match")},c.prototype.eventEnd=function(t,n,i){if(this.dataStatistics[t]){var e=this.dataStatistics[t].events;if(e&&0!==e.length){for(var r=e.length-1;0<=r;r--)if(e[r].event==n&&0==e[r].time_consumed){e[r].time_consumed=Date.now()-e[r].event_time;break}}else this.logger.info("zd.ee.0 no events")}else this.logger.info("zd.ee.0 no seq match")},c.prototype.eventEndWithMsg=function(t,n,i){if(this.dataStatistics[t]){var e=this.dataStatistics[t].events;if(e){for(var r=e.length-1;0<=r;r--)if(e[r].event==n&&0==e[r].time_consumed){e[r].time_consumed=Date.now()-e[r].event_time,null==e[r].msg_ext&&(e[r].msg_ext={}),e[r].msg_ext=L({},i);break}}else this.logger.warn("zd.ee.0 no events")}else this.logger.warn("zd.ee.0 no seq match")},c.prototype.eventEndWithMsgInfo=function(t,n,i){if(this.dataStatistics[t]){var e=this.dataStatistics[t].events;if(e){for(var r=e.length-1;0<=r;r--)if(e[r].event==n&&0==e[r].time_consumed){e[r].time_consumed=Date.now()-e[r].event_time,Object.assign(e[r],i);break}}else this.logger.warn("zd.ee.0 no events")}else this.logger.warn("zd.ee.0 no seq match")},c.prototype.addEventInfo=function(t,n,i,e){if(this.dataStatistics[t]){var r=this.dataStatistics[t].events;if(null==r)this.logger.warn("zd.aei.0 no events");else for(var o=r.length-1;0<=o;o--)if(r[o].event==n&&null!=r[o].time_consumed){null==r[o].msg_ext?r[o].msg_ext={}:r[o].msg_ext&&(r[o].msg_ext[i]=e);break}}else this.logger.warn("zd.aei.0 no seq match")},c.prototype.addEventMsg=function(t,n,i,e){if(this.dataStatistics[t]){var r=this.dataStatistics[t].events;if(null==r)this.logger.warn("zd.aem.0 no events");else for(var o=r.length-1;0<=o;o--)if(r[o].event==n){r[o][i]=e;break}}else this.logger.warn("zd.aem.0 no seq match")},c.prototype.addEvent=function(t,n,i){this.dataStatistics[t]?this.dataStatistics[t].events&&(i?this.dataStatistics[t].events.push({event:n,event_time:Date.now(),msg_ext:i}):this.dataStatistics[t].events.push({event:n,event_time:Date.now()})):this.logger.warn("zd.ae.0 no seq match")},c.prototype.uploadReport=function(t,n,i,e){var r=this.dataStatistics[t];null!=r&&(n&&(r.event=n),r.time_consumed=Date.now()-r.event_time,i&&this.addMsgInfo(t,{error:i.code,message:i.message||i.msg+" "+(e||"")}),this.logger.report(r),delete this.dataStatistics[t])},c);function c(t){this.dataStatistics={},this.logger=t}var h,f=["00","01","02","03","04","05","06","07","08","09"];function B(){var t=new Date;return[t.getFullYear()+"/",(f[t.getMonth()+1]||t.getMonth()+1)+"/",(f[t.getDate()]||t.getDate())+" ",(f[t.getHours()]||t.getHours())+":",(f[t.getMinutes()]||t.getMinutes())+":",f[t.getSeconds()]||t.getSeconds(),"."+t.getTime()%1e3].join("")}(b=h=h||{}).WEBSOCKET_STATE_CHANGE="zl.net.wsc",b.OPEN_WS="zl.net.opws";var G=function(t,n,i){if(i||2===arguments.length)for(var e,r=0,o=n.length;r<o;r++)!e&&r in n||((e=e||Array.prototype.slice.call(n,0,r))[r]=n[r]);return t.concat(e||Array.prototype.slice.call(n))},X=(Object.defineProperty(a.prototype,"url",{get:function(){return this.j.url},set:function(t){this.j.url=t},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"strategy",{get:function(){return this._.strategy},enumerable:!1,configurable:!0}),a.prototype.setStrategy=function(t){this._.setStrategy(t),this.S=this._.build()},a.prototype.addRemoteWsLog=function(t){var n;if(this.j.env!=r.BROWSER)throw new Error("cannot use net strategy on  mini program");this.closed()&&(n=this.url,this.url="",this.openWebSocketLogServer(n)),this.k.push(t),this.connected()&&this.S&&this.S.active()},a.prototype.stopWebSocketServer=function(){this.O&&(this.O.onclose=null,this.O.onerror=null,this.O.close(),this.O=null)},a.prototype.P=function(){this.O&&this.j.useStrategy&&(this._.setWs(this.O),this._.setCache(this.k),this.S=this._.build())},a.prototype.N=function(t){for(var n=[],i=1;i<arguments.length;i++)n[i-1]=arguments[i];var e=this.T,r="";switch(t){case"onconnecting":"never_opened"===this.T?this.T="first_connecting":this.T="reconnecting";break;case"onopen":this.T="connected";break;case"onclosed":this.T="closed";var o=n[0];o&&(r+=" close code=".concat(o.code));break;case"onerror":this.T="error"}t=h.WEBSOCKET_STATE_CHANGE+" log ws state change: ".concat(e," -> ").concat(this.T);r&&(t+=r),this.D.info(t)},a.prototype.openWebSocketLogServer=function(t){var i=this;this.url!=t&&((this.url&&""!==this.url||"never_opened"===this.T)&&this.D.info(h.OPEN_WS+" log url change to: ".concat(t)),this.url=t)&&(this.stopWebSocketServer(),this.O=M(t,this.j.env,this.I),this.P(),this.N("onconnecting"),this.O.onopen=function(){var t;i.j.useStrategy&&null!=(t=i.S)&&t.active(),i.N("onopen")},this.O.onclose=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];console.warn("onclose   websocket error:",t),i.N.apply(i,G(["onclosed"],t,!1))},this.O.onmessage=function(){},this.O.onerror=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];console.warn("open log websocket error:",t),i.N("onerror")})},a.prototype.closed=function(){return null==this.O||2==this.O.readyState||3==this.O.readyState},a.prototype.connected=function(){return null!==this.O&&1==this.O.readyState},a.prototype.connecting=function(){return null!==this.O&&0==this.O.readyState},a.prototype.wsSend=function(t){this.O&&this.O.send(t)},a.prototype.destroy=function(){this.O=null},a);function a(t,n,i,e){this.k=t,this.j=n,this.D=i,this.I=e,this.O=null,this.T="never_opened",this._=new lt,this.S=null}H.prototype.active=function(){var n=this;this.A&&1===this.A.readyState&&0!==this.k.size()&&this.q.canSendLog()&&(this.q.getLog().forEach(function(t){n.A.send(t)}),this.q.onSendLog())};var F=H;function H(t,n,i){this.A=t,this.k=n,this.q=i,this.q.onCanSendActive=this.active.bind(this)}function U(t){this.cache=t}Z=function(t,n){return(Z=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(t,n){t.__proto__=n}:function(t,n){for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i])}))(t,n)};(function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function i(){this.constructor=t}Z(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)})(l,K=U),l.prototype.getLog=function(){return this.cache.clear()},l.prototype.canSendLog=function(){return 0<this.cache.size()},l.prototype.onSendLog=function(){};var Z,K,V=l;function l(t){return K.call(this,t)||this}Q=function(t,n){return(Q=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(t,n){t.__proto__=n}:function(t,n){for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i])}))(t,n)};(function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function i(){this.constructor=t}Q(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)})(v,Y=U),v.prototype.canSendLog=function(){return!this.locked&&0<this.cache.size()},v.prototype.getLog=function(){for(var t=[],n=0;n<this.maxPacketLen-4e3;){var i=this.cache.getOneLogPacket();if(!i||i.length<=0)break;n+=i.length||0,t.push(i)}return t},v.prototype.onSendLog=function(){var t=this;this.locked=!0,setTimeout(function(){t.locked=!1,t.onCanSendActive&&t.onCanSendActive()},this.maxDelay)};var Q,Y,t=v;function v(){var t=null!==Y&&Y.apply(this,arguments)||this;return t.maxDelay=10,t.maxPacketLen=20480,t.locked=!1,t}$=function(t,n){return($=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(t,n){t.__proto__=n}:function(t,n){for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i])}))(t,n)};(function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function i(){this.constructor=t}$(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)})(it,tt=t);var $,tt,nt=it;function it(t){t=tt.call(this,t)||this;return t.maxDelay=10,t.maxPacketLen=20480,t}et=function(t,n){return(et=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(t,n){t.__proto__=n}:function(t,n){for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i])}))(t,n)};var et,rt;(function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function i(){this.constructor=t}et(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)})(ot,rt=t);function ot(){return null!==rt&&rt.apply(this,arguments)||this}st=function(t,n){return(st=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(t,n){t.__proto__=n}:function(t,n){for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i])}))(t,n)};var st,ut;(function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function i(){this.constructor=t}st(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)})(ct,ut=t);function ct(){return null!==ut&&ut.apply(this,arguments)||this}ht=function(t,n){return(ht=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(t,n){t.__proto__=n}:function(t,n){for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i])}))(t,n)};var ht,ft;(function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function i(){this.constructor=t}ht(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)})(at,ft=t);function at(){return null!==ft&&ft.apply(this,arguments)||this}Object.defineProperty(d.prototype,"strategy",{get:function(){return this.q},enumerable:!1,configurable:!0}),d.prototype.setWs=function(t){this.A=t},d.prototype.setCache=function(t){this.k=t},d.prototype.setStrategy=function(t){t&&(this.q=t)},d.prototype.build=function(){if(this.A&&this.k)return this.q!==i.DEFAULT?new F(this.A,this.k,new V(this.k)):new F(this.A,this.k,new nt(this.k));throw new Error("cannot build log sender")};var lt=d;function d(){this.q=i.DEFAULT}w.R=function(){return!(!window||!window.localStorage)},w.bin2hex=function(t){for(var n,i="",e=0,r=(t+="").length;e<r;e++)i+=(n=t.charCodeAt(e).toString(16)).length<2?"0"+n:n;return i},w.getCanvasFingerprint=function(t){var n=document.createElement("canvas"),i=n.getContext("2d"),i=(i.textBaseline="top",i.font="14px 'Arial'",i.fillStyle="#f60",i.fillRect(125,1,62,20),i.fillStyle="#069",i.fillText(t,2,15),i.fillStyle="rgba(102, 204, 0, 0.7)",i.fillText(t,4,17),n.toDataURL().replace("data:image/png;base64,","")),t=atob(i);return this.bin2hex(t.slice(-16,-12))},w.generateUUID=function(){var i,t,n=localStorage.getItem(this.C);return n||(i=(new Date).getTime(),n="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var n=(i+16*Math.random())%16|0;return i=Math.floor(i/16),("x"==t?n:3&n|8).toString(36)}),t=this.getCanvasFingerprint("hello, zego")+n.slice(8),localStorage.setItem(this.C,t),n)},w.id=function(){var t;return w.R()?((t=localStorage.getItem(this.C))||(t=w.generateUUID(),localStorage.setItem(this.C,t)),t):""},w.C="z_deviceID";var vt=w;function w(){}var dt=function(){this.url="",this.env=r.BROWSER,this.useStrategy=!0,this.token="",this.deviceid=vt.id()};Object.defineProperty(y.prototype,"buffer",{get:function(){return this.queue},set:function(t){this.queue=t},enumerable:!1,configurable:!0}),y.prototype.push=function(t){if(!t)throw new Error("item null!");t&&this.queue.push(t)},y.prototype.pop=function(){return this.queue.shift()},y.prototype.front=function(){return this.queue[0]};var b=y;function y(){this.queue=[]}wt=function(t,n){return(wt=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(t,n){t.__proto__=n}:function(t,n){for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i])}))(t,n)};var wt,bt,yt=function(){return(yt=Object.assign||function(t){for(var n,i=1,e=arguments.length;i<e;i++)for(var r in n=arguments[i])Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r]);return t}).apply(this,arguments)},mt=(function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function i(){this.constructor=t}wt(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}(m,bt=b),m.prototype.size=function(){return this.queue.length},m.prototype.getOneLogPacket=function(){var t="";if(this.size()){var n=JSON.parse(this.queue[this.queue.length-1]).userid,i=this.j.userid||n;if(i){for(;0<this.queue.length;){if(4e3<(t+this.queue[0]).length)return t;var e=JSON.parse(this.queue[0]),e=yt(yt({},e),{userid:e.userid||i,roomid:e.roomid||this.j.roomid,userName:e.userName||this.j.userName}),t=t+JSON.stringify(e)+"\n";this.queue.shift()}return""===t?void 0:t}}},m.prototype.clear=function(){for(var t=[];0<this.queue.length;){var n=this.getOneLogPacket();if(!n)break;t.push(n)}return t},m);function m(t){var n=bt.call(this)||this;return n.j=t,n}var pt=function(t,s,u,c){return new(u=u||Promise)(function(i,n){function e(t){try{o(c.next(t))}catch(t){n(t)}}function r(t){try{o(c.throw(t))}catch(t){n(t)}}function o(t){var n;t.done?i(t.value):((n=t.value)instanceof u?n:new u(function(t){t(n)})).then(e,r)}o((c=c.apply(t,s||[])).next())})},gt=function(e,r){var o,s,u,c={label:0,sent:function(){if(1&u[0])throw u[1];return u[1]},trys:[],ops:[]},h={next:t(0),throw:t(1),return:t(2)};return"function"==typeof Symbol&&(h[Symbol.iterator]=function(){return this}),h;function t(i){return function(t){var n=[i,t];if(o)throw new TypeError("Generator is already executing.");for(;c=h&&n[h=0]?0:c;)try{if(o=1,s&&(u=2&n[0]?s.return:n[0]?s.throw||((u=s.return)&&u.call(s),0):s.next)&&!(u=u.call(s,n[1])).done)return u;switch(s=0,(n=u?[2&n[0],u.value]:n)[0]){case 0:case 1:u=n;break;case 4:return c.label++,{value:n[1],done:!1};case 5:c.label++,s=n[1],n=[0];continue;case 7:n=c.ops.pop(),c.trys.pop();continue;default:if(!(u=0<(u=c.trys).length&&u[u.length-1])&&(6===n[0]||2===n[0])){c=0;continue}if(3===n[0]&&(!u||n[1]>u[0]&&n[1]<u[3]))c.label=n[1];else if(6===n[0]&&c.label<u[1])c.label=u[1],u=n;else{if(!(u&&c.label<u[2])){u[2]&&c.ops.pop(),c.trys.pop();continue}c.label=u[2],c.ops.push(n)}}n=r.call(e,c)}catch(t){n=[6,t],s=0}finally{o=u=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}}},Ot=(p.prototype.save=function(t){return this.J.save(this.M,{log:t})},p.prototype.queryList=function(t){return this.J.queryByCursor(this.M,t)},p.prototype.delete=function(t){return this.J.deleteItems(this.M,t)},p.prototype.storedBytesSize=function(){var t=this;return new Promise(function(e,r){return pt(t,void 0,void 0,function(){var n,i;return gt(this,function(t){return n=this.J.openCursor(this.M),i=0,n.onsuccess=function(t){var n,t=null==(t=t.target)?void 0:t.result;t?(n=t.value,i+=n.log.length,t.continue()):e(i)},n.onerror=function(t){r(t)},[2]})})})},p.prototype.lines=function(){return this.J.lines(this.M)},p.prototype.deleteByCount=function(t){return this.J.deleteByCount(this.M,t)},p.prototype.deleteAll=function(){return this.J.deleteAll(this.M)},p);function p(t){this.J=t,this.M="zego_log"}var g=function(t,s,u,c){return new(u=u||Promise)(function(i,n){function e(t){try{o(c.next(t))}catch(t){n(t)}}function r(t){try{o(c.throw(t))}catch(t){n(t)}}function o(t){var n;t.done?i(t.value):((n=t.value)instanceof u?n:new u(function(t){t(n)})).then(e,r)}o((c=c.apply(t,s||[])).next())})},O=function(e,r){var o,s,u,c={label:0,sent:function(){if(1&u[0])throw u[1];return u[1]},trys:[],ops:[]},h={next:t(0),throw:t(1),return:t(2)};return"function"==typeof Symbol&&(h[Symbol.iterator]=function(){return this}),h;function t(i){return function(t){var n=[i,t];if(o)throw new TypeError("Generator is already executing.");for(;c=h&&n[h=0]?0:c;)try{if(o=1,s&&(u=2&n[0]?s.return:n[0]?s.throw||((u=s.return)&&u.call(s),0):s.next)&&!(u=u.call(s,n[1])).done)return u;switch(s=0,(n=u?[2&n[0],u.value]:n)[0]){case 0:case 1:u=n;break;case 4:return c.label++,{value:n[1],done:!1};case 5:c.label++,s=n[1],n=[0];continue;case 7:n=c.ops.pop(),c.trys.pop();continue;default:if(!(u=0<(u=c.trys).length&&u[u.length-1])&&(6===n[0]||2===n[0])){c=0;continue}if(3===n[0]&&(!u||n[1]>u[0]&&n[1]<u[3]))c.label=n[1];else if(6===n[0]&&c.label<u[1])c.label=u[1],u=n;else{if(!(u&&c.label<u[2])){u[2]&&c.ops.pop(),c.trys.pop();continue}c.label=u[2],c.ops.push(n)}}n=r.call(e,c)}catch(t){n=[6,t],s=0}finally{o=u=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}}},jt=(j.prototype.openDB=function(r){return g(this,void 0,void 0,function(){var i,n,e=this;return O(this,function(t){switch(t.label){case 0:return i=window.indexedDB.open(r.database,r.version),n=this,[4,new Promise(function(n){i.onupgradeneeded=function(t){var i=t.target&&t.target.result;r.tableList.forEach(function(t){var n;i.objectStoreNames.contains(t.tableName)||(n=i.createObjectStore(t.tableName,{keyPath:"id",autoIncrement:!0}),t.tableItems.forEach(function(t){t.index&&n.createIndex(t.itemName,t.itemName,{unique:t.unique})}))})},i.onsuccess=function(t){t=t.target&&t.target.result;e.L=t,n(i)}})];case 1:return n.W=t.sent(),[2]}})})},j.prototype.B=function(){if(!this.W&&!this.L)throw new Error("indexDB not open")},j.prototype.save=function(o,s){var t=this;return new Promise(function(e,r){return g(t,void 0,void 0,function(){var n,i;return O(this,function(t){return this.B(),n=this.L.transaction([o],"readwrite").objectStore(o),(i=n.add(s)).onsuccess=function(t){e(i.result)},i.onerror=function(t){r("save item fail")},[2]})})})},j.prototype.update=function(t,n){var i=this;return new Promise(function(t,n){i.B(),t()})},j.prototype.queryById=function(o,s){var t=this;return new Promise(function(e,r){return g(t,void 0,void 0,function(){var n,i;return O(this,function(t){return this.B(),n=this.L.transaction([o]).objectStore(o),(i=n.get(s)).onsuccess=function(t){i.result?e(i.result):e(null)},i.onerror=function(t){r()},[2]})})})},j.prototype.queryByCursor=function(o,s){var t=this;return new Promise(function(e,r){return g(t,void 0,void 0,function(){var n,i;return O(this,function(t){return this.B(),i=this.L.transaction([o]).objectStore(o),n=[],(i=i.openCursor()).onsuccess=function(t){t=null==(t=t.target)?void 0:t.result;t&&(!s||n.length<s)?(n.push(t.value),t.continue()):e(n)},i.onerror=function(t){r()},[2]})})})},j.prototype.lines=function(o){var t=this;return new Promise(function(e,r){return g(t,void 0,void 0,function(){var n,i;return O(this,function(t){return this.B(),n=this.L.transaction([o]).objectStore(o),n=n.openCursor(),i=0,n.onsuccess=function(t){t=null==(t=t.target)?void 0:t.result;t?(i++,t.continue()):e(i)},n.onerror=function(t){r()},[2]})})})},j.prototype.openCursor=function(t){return this.B(),this.L.transaction([t]).objectStore(t).openCursor()},j.prototype.deleteById=function(r,o){var t=this;return new Promise(function(i,e){return g(t,void 0,void 0,function(){var n;return O(this,function(t){return this.B(),n=this.L.transaction([r],"readwrite").objectStore(r),(n=n.delete(o)).onsuccess=function(t){i()},n.onerror=function(t){e()},[2]})})})},j.prototype.deleteByCount=function(r,o){var n=this;return new Promise(function(e,t){return g(n,void 0,void 0,function(){var n,i;return O(this,function(t){switch(t.label){case 0:this.B(),n=8192,t.label=1;case 1:return 0<o?[4,this.queryByCursor(r,Math.min(o,n))]:[3,4];case 2:return 0===(i=t.sent()).length?[3,4]:(o-=n,[4,this.deleteItems(r,i)]);case 3:return t.sent(),[3,1];case 4:return e(),[2]}})})})},j.prototype.deleteAll=function(r){var t=this;return new Promise(function(i,e){return g(t,void 0,void 0,function(){var n;return O(this,function(t){return this.B(),n=this.L.transaction([r],"readwrite").objectStore(r),(n=n.clear()).onsuccess=function(t){i()},n.onerror=function(t){e()},[2]})})})},j.prototype.deleteItems=function(i,e){var t=this;return new Promise(function(n){return g(t,void 0,void 0,function(){var r;return O(this,function(t){switch(t.label){case 0:return this.B(),r=this.L.transaction([i],"readwrite").objectStore(i),[4,Promise.all(e.map(function(e){return new Promise(function(n,i){var t=r.delete(e.id);t.onsuccess=function(t){n()},t.onerror=function(t){i()}})}))];case 1:return t.sent(),n(),[2]}})})})},j);function j(){}var xt={version:1,database:"zego_logger_db",tableList:[{tableName:"zego_log",tableItems:[{itemName:"log",index:!1,unique:!1}]}]};_t=function(t,n){return(_t=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(t,n){t.__proto__=n}:function(t,n){for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i])}))(t,n)};(function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function i(){this.constructor=t}_t(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)})(kt,St=b);var _t,St,Et=kt;function kt(){return null!==St&&St.apply(this,arguments)||this}var x=function(){return(x=Object.assign||function(t){for(var n,i=1,e=arguments.length;i<e;i++)for(var r in n=arguments[i])Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r]);return t}).apply(this,arguments)},Pt=function(t,s,u,c){return new(u=u||Promise)(function(i,n){function e(t){try{o(c.next(t))}catch(t){n(t)}}function r(t){try{o(c.throw(t))}catch(t){n(t)}}function o(t){var n;t.done?i(t.value):((n=t.value)instanceof u?n:new u(function(t){t(n)})).then(e,r)}o((c=c.apply(t,s||[])).next())})},Nt=function(e,r){var o,s,u,c={label:0,sent:function(){if(1&u[0])throw u[1];return u[1]},trys:[],ops:[]},h={next:t(0),throw:t(1),return:t(2)};return"function"==typeof Symbol&&(h[Symbol.iterator]=function(){return this}),h;function t(i){return function(t){var n=[i,t];if(o)throw new TypeError("Generator is already executing.");for(;c=h&&n[h=0]?0:c;)try{if(o=1,s&&(u=2&n[0]?s.return:n[0]?s.throw||((u=s.return)&&u.call(s),0):s.next)&&!(u=u.call(s,n[1])).done)return u;switch(s=0,(n=u?[2&n[0],u.value]:n)[0]){case 0:case 1:u=n;break;case 4:return c.label++,{value:n[1],done:!1};case 5:c.label++,s=n[1],n=[0];continue;case 7:n=c.ops.pop(),c.trys.pop();continue;default:if(!(u=0<(u=c.trys).length&&u[u.length-1])&&(6===n[0]||2===n[0])){c=0;continue}if(3===n[0]&&(!u||n[1]>u[0]&&n[1]<u[3]))c.label=n[1];else if(6===n[0]&&c.label<u[1])c.label=u[1],u=n;else{if(!(u&&c.label<u[2])){u[2]&&c.ops.pop(),c.trys.pop();continue}c.label=u[2],c.ops.push(n)}}n=r.call(e,c)}catch(t){n=[6,t],s=0}finally{o=u=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}}},Tt=(_.prototype.pushTask=function(t,n,i,e,r){t={task:t};n&&(t=x(x({},t),{args:n})),i&&(t=x(x({},t),{successCallback:i})),e&&(t=x(x({},t),{errorCallback:e})),r&&(t=x(x({},t),{completeCallback:r})),this.G.push(t)},_.prototype.X=function(e){return Pt(this,void 0,void 0,function(){var n,i;return Nt(this,function(t){switch(t.label){case 0:n=null,t.label=1;case 1:return(t.trys.push([1,4,5,6]),e&&e.args?n=e.task.apply(e,e.args):e&&(n=e.task()),n instanceof Promise)?[4,n]:[3,3];case 2:n=t.sent(),t.label=3;case 3:return e.successCallback&&e.successCallback(n),[3,6];case 4:if(i=t.sent(),e.errorCallback)return e.errorCallback(i),[3,6];throw i;case 5:return e.completeCallback&&e.completeCallback(),[7];case 6:return[2]}})})},_.prototype.runATask=function(){return Pt(this,void 0,void 0,function(){var n;return Nt(this,function(t){switch(t.label){case 0:return this.G.length<=0?[2]:(n=this.G.shift(),n?[4,this.X(n)]:[3,2]);case 1:t.sent(),t.label=2;case 2:return[2]}})})},_.prototype.runAllTask=function(){return Pt(this,void 0,void 0,function(){var n;return Nt(this,function(t){switch(t.label){case 0:return 0<this.G.length?(n=this.G.shift(),n?[4,this.X(n)]:[3,2]):[3,3];case 1:t.sent(),t.label=2;case 2:return[3,0];case 3:return[2]}})})},_.prototype.size=function(){return this.G.length},_);function _(){this.G=[]}var zt=n(0),Dt=(S.prototype.writeLine=function(t){t&&""!==t&&this.F.push(t)},S.prototype.saveAs=function(t,n){var i=document.createElement("a");i.href=URL.createObjectURL(t),i.download=n,i.click()},S.prototype.createZip=function(){var t="",t=(0<this.F.length&&(t=this.F.join("\n"),this.F=[]),Object(zt.deflate)(t)),t=this.uint8arrayToBase64(t);return new Blob([t],{type:"text/plain;charset=utf-8"})},S.prototype.uint8arrayToBase64=function(t){for(var n,i=0,e=t.length,r="";i<e;)n=t.subarray(i,Math.min(i+32768,e)),r+=String.fromCharCode.apply(null,Array.from(n)),i+=32768;return btoa(r)},S);function S(){this.F=[]}var E=function(t,s,u,c){return new(u=u||Promise)(function(i,n){function e(t){try{o(c.next(t))}catch(t){n(t)}}function r(t){try{o(c.throw(t))}catch(t){n(t)}}function o(t){var n;t.done?i(t.value):((n=t.value)instanceof u?n:new u(function(t){t(n)})).then(e,r)}o((c=c.apply(t,s||[])).next())})},k=function(e,r){var o,s,u,c={label:0,sent:function(){if(1&u[0])throw u[1];return u[1]},trys:[],ops:[]},h={next:t(0),throw:t(1),return:t(2)};return"function"==typeof Symbol&&(h[Symbol.iterator]=function(){return this}),h;function t(i){return function(t){var n=[i,t];if(o)throw new TypeError("Generator is already executing.");for(;c=h&&n[h=0]?0:c;)try{if(o=1,s&&(u=2&n[0]?s.return:n[0]?s.throw||((u=s.return)&&u.call(s),0):s.next)&&!(u=u.call(s,n[1])).done)return u;switch(s=0,(n=u?[2&n[0],u.value]:n)[0]){case 0:case 1:u=n;break;case 4:return c.label++,{value:n[1],done:!1};case 5:c.label++,s=n[1],n=[0];continue;case 7:n=c.ops.pop(),c.trys.pop();continue;default:if(!(u=0<(u=c.trys).length&&u[u.length-1])&&(6===n[0]||2===n[0])){c=0;continue}if(3===n[0]&&(!u||n[1]>u[0]&&n[1]<u[3]))c.label=n[1];else if(6===n[0]&&c.label<u[1])c.label=u[1],u=n;else{if(!(u&&c.label<u[2])){u[2]&&c.ops.pop(),c.trys.pop();continue}c.label=u[2],c.ops.push(n)}}n=r.call(e,c)}catch(t){n=[6,t],s=0}finally{o=u=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}}},It=(P.prototype.H=function(){return!!(this.j.appid&&this.j.userid&&""!==this.j.userid&&this.j.token&&""!==this.j.token&&this.j.deviceid&&""!==this.j.deviceid)},P.prototype.setUploadUrl=function(t){this.U=t},P.prototype.upload=function(o){return E(this,void 0,void 0,function(){var n=this;return k(this,function(t){if(this.H())return[2,new Promise(function(e,r){return E(n,void 0,void 0,function(){var n,i=this;return k(this,function(t){switch(t.label){case 0:return(n=function(){return E(i,void 0,void 0,function(){var n,i,e=this;return k(this,function(t){switch(t.label){case 0:this.Z=!0,(n=new FormData).append("logs",o),n.append("hello",this.j.appid.toString()),n.append("appid",this.j.appid.toString()),n.append("uin",this.j.userid.toString()),n.append("timestamp",(new Date).getTime().toString()),n.append("token",this.j.token),n.append("deviceid",this.j.deviceid),t.label=1;case 1:return t.trys.push([1,3,4,5]),[4,Rt.post(this.U,n,this.proxyCtrl)];case 2:if(0!==(i=t.sent()).code)throw new Error("upload logs failed, error=".concat(JSON.stringify(i)));return[3,5];case 3:return i=t.sent(),r(i),[3,5];case 4:return setTimeout(function(){return E(e,void 0,void 0,function(){return k(this,function(t){switch(t.label){case 0:return this.Z=!1,[4,this.K.runATask()];case 1:return t.sent(),[2]}})})},100),[7];case 5:return[2]}})})},this.Z)?(this.K.pushTask(n,[],function(){e()},function(t){r(t)}),[3,3]):[3,1];case 1:return[4,n()];case 2:t.sent(),e(),t.label=3;case 3:return[2]}})})})];throw new Error("cannot upload logs, please login room before you upload logs.")})})},P);function P(t,n){this.j=t,this.proxyCtrl=n,this.V="detaillog-global.zego.im",this.U="https://".concat(this.V,"/log/userupload"),this.K=new Tt,this.Z=!1}var At=function(t,s,u,c){return new(u=u||Promise)(function(i,n){function e(t){try{o(c.next(t))}catch(t){n(t)}}function r(t){try{o(c.throw(t))}catch(t){n(t)}}function o(t){var n;t.done?i(t.value):((n=t.value)instanceof u?n:new u(function(t){t(n)})).then(e,r)}o((c=c.apply(t,s||[])).next())})},qt=function(e,r){var o,s,u,c={label:0,sent:function(){if(1&u[0])throw u[1];return u[1]},trys:[],ops:[]},h={next:t(0),throw:t(1),return:t(2)};return"function"==typeof Symbol&&(h[Symbol.iterator]=function(){return this}),h;function t(i){return function(t){var n=[i,t];if(o)throw new TypeError("Generator is already executing.");for(;c=h&&n[h=0]?0:c;)try{if(o=1,s&&(u=2&n[0]?s.return:n[0]?s.throw||((u=s.return)&&u.call(s),0):s.next)&&!(u=u.call(s,n[1])).done)return u;switch(s=0,(n=u?[2&n[0],u.value]:n)[0]){case 0:case 1:u=n;break;case 4:return c.label++,{value:n[1],done:!1};case 5:c.label++,s=n[1],n=[0];continue;case 7:n=c.ops.pop(),c.trys.pop();continue;default:if(!(u=0<(u=c.trys).length&&u[u.length-1])&&(6===n[0]||2===n[0])){c=0;continue}if(3===n[0]&&(!u||n[1]>u[0]&&n[1]<u[3]))c.label=n[1];else if(6===n[0]&&c.label<u[1])c.label=u[1],u=n;else{if(!(u&&c.label<u[2])){u[2]&&c.ops.pop(),c.trys.pop();continue}c.label=u[2],c.ops.push(n)}}n=r.call(e,c)}catch(t){n=[6,t],s=0}finally{o=u=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}}},Rt=(Ct.post=function(r,o,s){var t=this;return new Promise(function(i,e){return At(t,void 0,void 0,function(){var n;return qt(this,function(t){try{s?s.startHttpRequest({location:r,body:o,method_no:2,headers:[{name:"Content-Type",val:"multipart/form-data"}],serviceType:2},function(t){200===t.status_code?i(t.body):e("request fail. status="+t.status_code)},function(t){e("request fail. result: "+JSON.stringify(t))}):((n=new XMLHttpRequest).open("POST",r,!0),n.responseType="json",n.send(o),n.onreadystatechange=function(){n.readyState===XMLHttpRequest.DONE&&(200===n.status?i(n.response):e("request fail. status="+n.status))})}catch(t){e(t)}return[2]})})})},Ct);function Ct(){}var N=function(){return(N=Object.assign||function(t){for(var n,i=1,e=arguments.length;i<e;i++)for(var r in n=arguments[i])Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r]);return t}).apply(this,arguments)},Jt=(Mt.prototype.build=function(t){var n=N(N({},JSON.parse(t)),{sdkid:this.Y});if(++this.$%100==0)return(t=JSON.stringify(n)).substring(1,t.length-1);for(i in n)this.tt.includes(i)||(n[i]===this.nt[i]?delete n[i]:this.nt[i]=n[i]);var i,e=[];for(i in n)this.tt.includes(i)?e.push(n[i]):e.push("".concat(i,":").concat(n[i]));return e.join(",")},Mt.prototype.buildFullMessageLog=function(t){t=JSON.parse(t),t=N(N(N({},this.nt),t),{sdkid:this.Y});return JSON.stringify(t)},Mt);function Mt(t){this.j=t,this.nt={},this.tt=["time","action","content","sdkid"],this.$=0,this.Y=(t=5,crypto.getRandomValues(new Uint8Array(t)).reduce((t,n)=>t+=(n&=63)<36?n.toString(36):n<62?(n-26).toString(36).toUpperCase():62<n?"-":"_",""))}var T=function(t,s,u,c){return new(u=u||Promise)(function(i,n){function e(t){try{o(c.next(t))}catch(t){n(t)}}function r(t){try{o(c.throw(t))}catch(t){n(t)}}function o(t){var n;t.done?i(t.value):((n=t.value)instanceof u?n:new u(function(t){t(n)})).then(e,r)}o((c=c.apply(t,s||[])).next())})},z=function(e,r){var o,s,u,c={label:0,sent:function(){if(1&u[0])throw u[1];return u[1]},trys:[],ops:[]},h={next:t(0),throw:t(1),return:t(2)};return"function"==typeof Symbol&&(h[Symbol.iterator]=function(){return this}),h;function t(i){return function(t){var n=[i,t];if(o)throw new TypeError("Generator is already executing.");for(;c=h&&n[h=0]?0:c;)try{if(o=1,s&&(u=2&n[0]?s.return:n[0]?s.throw||((u=s.return)&&u.call(s),0):s.next)&&!(u=u.call(s,n[1])).done)return u;switch(s=0,(n=u?[2&n[0],u.value]:n)[0]){case 0:case 1:u=n;break;case 4:return c.label++,{value:n[1],done:!1};case 5:c.label++,s=n[1],n=[0];continue;case 7:n=c.ops.pop(),c.trys.pop();continue;default:if(!(u=0<(u=c.trys).length&&u[u.length-1])&&(6===n[0]||2===n[0])){c=0;continue}if(3===n[0]&&(!u||n[1]>u[0]&&n[1]<u[3]))c.label=n[1];else if(6===n[0]&&c.label<u[1])c.label=u[1],u=n;else{if(!(u&&c.label<u[2])){u[2]&&c.ops.pop(),c.trys.pop();continue}c.label=u[2],c.ops.push(n)}}n=r.call(e,c)}catch(t){n=[6,t],s=0}finally{o=u=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}}},Lt=(Object.defineProperty(D.prototype,"dbOpened",{get:function(){return this.it},enumerable:!1,configurable:!0}),Object.defineProperty(D.prototype,"dbTryOpened",{get:function(){return this.et},enumerable:!1,configurable:!0}),D.prototype.rt=function(){return T(this,void 0,void 0,function(){var n;return z(this,function(t){switch(t.label){case 0:return[4,this.ot.lines()];case 1:return 153600<(n=t.sent())?[4,this.ot.deleteByCount(n/2)]:[3,3];case 2:t.sent(),t.label=3;case 3:return[2]}})})},D.prototype.makeStorageSpaceUpload=function(){return T(this,void 0,void 0,function(){var r,n=this;return z(this,function(t){return this.st?(r=function(){return T(n,void 0,void 0,function(){return z(this,function(t){switch(t.label){case 0:return[4,this.ot.lines()];case 1:return 3072<t.sent()?[4,this.ut()]:[3,3];case 2:t.sent(),t.label=3;case 3:return[2]}})})},[2,new Promise(function(i,e){return T(n,void 0,void 0,function(){var n;return z(this,function(t){switch(t.label){case 0:return this.dbOpened?[3,1]:(this.ct.pushTask(r,[],function(){i()},function(t){e(t)}),[3,5]);case 1:return t.trys.push([1,3,,4]),[4,r()];case 2:return t.sent(),[3,4];case 3:return n=t.sent(),e(n),[2];case 4:i(),t.label=5;case 5:return[2]}})})})]):[2]})})},D.prototype.openDB=function(){return T(this,void 0,void 0,function(){return z(this,function(t){switch(t.label){case 0:return this.et?[2]:(this.et=!0,[4,this.J.openDB(xt)]);case 1:return t.sent(),this.it=!0,[4,this.rt()];case 2:return t.sent(),[4,this.ct.runAllTask()];case 3:return t.sent(),[4,this.ht.runATask()];case 4:return t.sent(),this.ft(),[2]}})})},D.prototype.lt=function(){return this.st&&D.isEnvSupport()&&!this.it&&!this.et},D.prototype.enable=function(){this.st||(this.st=!0,this.lt()&&this.openDB())},D.prototype.saveLog=function(t){this.lt()&&this.openDB(),this.k.push(this.vt.build(t)),this.ft()},D.prototype.removeLogList=function(n){return T(this,void 0,void 0,function(){return z(this,function(t){switch(t.label){case 0:return 0===n.length?[2]:[4,this.ot.delete(n)];case 1:return t.sent(),[2]}})})},D.prototype.empty=function(){return T(this,void 0,void 0,function(){return z(this,function(t){switch(t.label){case 0:return[4,this.ot.queryList(1)];case 1:return[2,0===t.sent().length]}})})},D.prototype.ft=function(){var n,i=this;this.st&&this.dbOpened&&!this.dt&&(this.dt=!0,(n=function(){var t=i.k.front();t?t&&i.ot.save(t).then(function(){i.k.pop(),n()}).catch(function(t){i.dt=!1,console.error(t)}):i.dt=!1})())},D.isEnvSupport=function(){return!!(window&&"indexedDB"in window)},D.prototype.wt=function(){return T(this,void 0,void 0,function(){var r,o,n,s;return z(this,function(t){switch(t.label){case 0:return[4,this.ot.lines()];case 1:r=t.sent(),o=3145728,n=function(){var n,i,e;return z(this,function(t){switch(t.label){case 0:return[4,s.ot.queryList(Math.min(o,r))];case 1:return(n=t.sent(),r-=o,n.length<=0)?[2,"break"]:(i=new Dt,n.forEach(function(t){i.writeLine(t.log)}),e=i.createZip(),[4,s.bt.upload(e)]);case 2:return t.sent(),[4,s.ot.delete(n)];case 3:return t.sent(),[2]}})},s=this,t.label=2;case 2:return 0<r?[5,n()]:[3,4];case 3:return"break"===t.sent()?[3,4]:[3,2];case 4:return[2]}})})},D.prototype.ut=function(){var t=this;return new Promise(function(e,r){return T(t,void 0,void 0,function(){var n,i=this;return z(this,function(t){return n=function(){return T(i,void 0,void 0,function(){return z(this,function(t){switch(t.label){case 0:return[4,this.wt()];case 1:return t.sent(),[2]}})})},this.ht.pushTask(n,[],function(){e()},function(t){r(t)},function(){0<i.ht.size()&&i.ht.runATask()}),this.dbOpened&&1===this.ht.size()&&this.ht.runATask(),[2]})})})},D.prototype.yt=function(){var t=this;return new Promise(function(e,r){return T(t,void 0,void 0,function(){var n,i=this;return z(this,function(t){return this.gt=!1,this.Ot=!0,n=function(){return T(i,void 0,void 0,function(){return z(this,function(t){switch(t.label){case 0:return this.Ot=!0,[4,this.wt()];case 1:return t.sent(),[2]}})})},this.ht.pushTask(n,[],function(){i.gt=!0,i.Ot=!1,e()},function(t){i.Ot=!1,r(t)},function(){0<i.ht.size()&&i.ht.runATask()}),this.dbOpened&&1===this.ht.size()&&this.ht.runATask(),[2]})})})},D.prototype.setUploadUrl=function(t){this.bt.setUploadUrl(t)},D.prototype.startUpload=function(){return T(this,void 0,void 0,function(){return z(this,function(t){switch(t.label){case 0:if(!this.st)throw new Error("zip logs upload is not enabled.");if(0!==this.jt&&performance.now()-this.jt<6e4&&this.gt||this.Ot)throw new Error("Logs upload failed. Do not report frequently.");return this.jt=performance.now(),[4,this.yt()];case 1:return t.sent(),[2]}})})},D.prototype.destroy=function(){},D);function D(t,n){this.j=t,this.proxyCtrl=n,this.J=new jt,this.ot=new Ot(this.J),this.it=!1,this.et=!1,this.k=new Et,this.dt=!1,this.ct=new Tt,this.ht=new Tt,this.st=!1,this.jt=0,this.gt=!1,this.Ot=!1,this.bt=new It(this.j,n),this.vt=new Jt(this.j)}var Wt=function(){return(Wt=Object.assign||function(t){for(var n,i=1,e=arguments.length;i<e;i++)for(var r in n=arguments[i])Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r]);return t}).apply(this,arguments)},I=function(t,s,u,c){return new(u=u||Promise)(function(i,n){function e(t){try{o(c.next(t))}catch(t){n(t)}}function r(t){try{o(c.throw(t))}catch(t){n(t)}}function o(t){var n;t.done?i(t.value):((n=t.value)instanceof u?n:new u(function(t){t(n)})).then(e,r)}o((c=c.apply(t,s||[])).next())})},A=function(e,r){var o,s,u,c={label:0,sent:function(){if(1&u[0])throw u[1];return u[1]},trys:[],ops:[]},h={next:t(0),throw:t(1),return:t(2)};return"function"==typeof Symbol&&(h[Symbol.iterator]=function(){return this}),h;function t(i){return function(t){var n=[i,t];if(o)throw new TypeError("Generator is already executing.");for(;c=h&&n[h=0]?0:c;)try{if(o=1,s&&(u=2&n[0]?s.return:n[0]?s.throw||((u=s.return)&&u.call(s),0):s.next)&&!(u=u.call(s,n[1])).done)return u;switch(s=0,(n=u?[2&n[0],u.value]:n)[0]){case 0:case 1:u=n;break;case 4:return c.label++,{value:n[1],done:!1};case 5:c.label++,s=n[1],n=[0];continue;case 7:n=c.ops.pop(),c.trys.pop();continue;default:if(!(u=0<(u=c.trys).length&&u[u.length-1])&&(6===n[0]||2===n[0])){c=0;continue}if(3===n[0]&&(!u||n[1]>u[0]&&n[1]<u[3]))c.label=n[1];else if(6===n[0]&&c.label<u[1])c.label=u[1],u=n;else{if(!(u&&c.label<u[2])){u[2]&&c.ops.pop(),c.trys.pop();continue}c.label=u[2],c.ops.push(n)}}n=r.call(e,c)}catch(t){n=[6,t],s=0}finally{o=u=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}}},Bt=(Object.defineProperty(q.prototype,"url",{get:function(){return this.j.url||""},set:function(t){this.j.url=t},enumerable:!1,configurable:!0}),Object.defineProperty(q.prototype,"logType",{get:function(){return this.j.logType||o.DISABLE},set:function(t){this.j.logType=t},enumerable:!1,configurable:!0}),Object.defineProperty(q.prototype,"env",{get:function(){return this.j.env},set:function(t){this.j.env=t},enumerable:!1,configurable:!0}),Object.defineProperty(q.prototype,"appid",{get:function(){return this.j.appid},set:function(t){this.j.appid=t},enumerable:!1,configurable:!0}),Object.defineProperty(q.prototype,"roomid",{get:function(){return this.j.roomid},set:function(t){this.j.roomid=t},enumerable:!1,configurable:!0}),Object.defineProperty(q.prototype,"sessionid",{get:function(){return this.j.sessionid},set:function(t){this.j.sessionid=t},enumerable:!1,configurable:!0}),Object.defineProperty(q.prototype,"userid",{get:function(){return this.j.userid},set:function(t){this.j.userid=t},enumerable:!1,configurable:!0}),Object.defineProperty(q.prototype,"userName",{get:function(){return this.j.userName},set:function(t){this.j.userName=t},enumerable:!1,configurable:!0}),Object.defineProperty(q.prototype,"version",{get:function(){return this.j.version},set:function(t){this.j.version=t},enumerable:!1,configurable:!0}),q.prototype.setLogLevel=function(t){t=s[t];return void 0!==t&&(this.logLevel=t,!0)},q.prototype.setRemoteLogLevel=function(t){t=s[t];return void 0!==t&&(this.logRemoteLevel=t,!0)},q.prototype.setSessionInfo=function(t,n,i,e,r,o){this.appid=t,this.roomid=n,this.sessionid=i,this.userid=e,this.userName=r,this.version=o},q.prototype.setTokenInfo=function(t,n,i){this.j.token=t||"",n&&(this.j.userid=n),i&&(this.j.userName=i)},q.prototype.setZipLogConfig=function(t,n){1===t&&this.xt?this.xt.enable():0==t&&n&&this.xt&&(this.xt.destroy(),this.xt=null)},q.prototype.setZipLogUploadUrl=function(t){this.xt&&this.xt.setUploadUrl(t)},q.prototype.makeZipLogSpaceUpload=function(){return I(this,void 0,void 0,function(){return A(this,function(t){switch(t.label){case 0:return this.xt?[4,this.xt.makeStorageSpaceUpload()]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})},q.prototype.uploadStorageLog=function(){return I(this,void 0,void 0,function(){return A(this,function(t){switch(t.label){case 0:return this.xt?[4,this.xt.startUpload()]:[3,2];case 1:return t.sent(),[3,3];case 2:throw new Error("cannot use zip log module");case 3:return[2]}})})},q.prototype.report=function(t){t=this._t(s.REPORT,t);this.logLevel!==s.DISABLE&&this.logLevel<=s.REPORT&&!this.isDestroy&&console.debug(t),this.St(s.REPORT,t,!0)},q.prototype.debug=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];var i=this.Et(s.DEBUG,t.join(""));this.logLevel!==s.DISABLE&&this.logLevel<=s.DEBUG&&!this.isDestroy&&console.debug(i),this.kt(s.DEBUG,i)},q.prototype.info=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];var i=this.Et(s.INFO,t.join(""));this.logLevel!==s.DISABLE&&this.logLevel<=s.INFO&&!this.isDestroy&&console.info(i),this.kt(s.INFO,i)},q.prototype.warn=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];var i=this.Et(s.WARN,t.join(""));this.logLevel!==s.DISABLE&&this.logLevel<=s.WARN&&!this.isDestroy&&console.warn(i),this.kt(s.WARN,i)},q.prototype.remoteReport=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];var i=this.Et(s.INFO,t.join(""));this.kt(s.INFO,i)},q.prototype.error=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];var i=this.Et(s.ERROR,t.join(""));this.logLevel!==s.DISABLE&&this.logLevel<=s.ERROR&&!this.isDestroy&&(console.error(i),this.env%2===r.BROWSER&&window?this.stateCenter.debug&&window.alert(t.join("").substr(t.join("").indexOf(" ")+1,4500)):(this.env,r.WEIXINMINI)),this.kt(s.ERROR,i)},q.prototype.kt=function(t,n){this.logRemoteLevel!==s.DISABLE&&this.logRemoteLevel<=t&&(this.St(t,n),this.xt)&&this.xt.saveLog(n)},q.prototype.setLogServer=function(t){if(this.isDestroy)return!1;try{return t.startsWith("wss:")?(this.logType=o.WEBSOCKET,this.Pt.openWebSocketLogServer(t)):t.startsWith("https:")?(this.logType=o.HTTPS,this.Nt(t)):this.logType=o.DISABLE,!0}catch(t){return this.error(JSON.stringify(t)),!1}},q.prototype.Tt=function(){this.logType==o.WEBSOCKET?this.zt():this.logType==o.HTTPS&&(this.Dt(),this.It()),this.logType=o.DISABLE},q.prototype.zt=function(){this.Pt.stopWebSocketServer()},q.prototype.Nt=function(t){var n=this;(this.url=t)&&(this.It(),this.logUploadTimer||(this.logUploadTimer=setInterval(function(){n.Dt()},this.logUploadInterval)))},q.prototype.It=function(){this.logUploadTimer&&(clearInterval(this.logUploadTimer),this.logUploadTimer=null)},q.prototype.St=function(n,i,e){return void 0===e&&(e=!1),I(this,void 0,void 0,function(){return A(this,function(t){if(!this.isDestroy)if(this.logType==o.WEBSOCKET)this.At(n,i);else if(this.logType==o.HTTPS)this.qt(n,i,e);else if(this.logLevel!==s.DISABLE&&this.logLevel<=n)for(this.Rt.push(i);this.Rt.size()>this.Ct;)this.Rt.pop();return[2]})})},q.prototype.Jt=function(){var n=this;this.Pt.connected()&&this.Rt.clear().forEach(function(t){n.Pt.wsSend(t)})},q.prototype.clearCache=function(){0!==this.Rt.size()&&this.Jt()},q.prototype.Mt=function(t){this.Rt.size()<this.Ct&&this.Rt.push(t)},q.prototype.Lt=function(t){this.Pt.connected()?this.Pt.wsSend(t):this.Mt(t)},q.prototype.At=function(t,i){return I(this,void 0,void 0,function(){var n;return A(this,function(t){return"string"==typeof i&&4e3<i.length?console.info("log over maximum, ignore"):this.j.useStrategy&&this.env==r.BROWSER?this.Pt.addRemoteWsLog(i):this.Pt.closed()?(n=this.url,this.url="",this.setLogServer(n),this.Mt(i)):this.Pt.connecting()?this.Mt(i):this.Pt.connected()&&(this.clearCache(),this.Lt(i)),[2]})})},q.prototype.qt=function(t,n,i){this.Rt.push(n),(this.Rt.size()>=this.Ct||!0===i)&&this.Dt()},q.prototype.Et=function(t,n){var i=B(),n=[n.substr(0,n.indexOf(" "))||n,n.substr(n.indexOf(" ")+1,4500)||n],i={time:i,level:t,action:n[0],content:n[1],appid:this.appid,roomid:this.roomid,userid:this.userid,userName:this.userName,sessionid:this.sessionid};return JSON.stringify(i)},q.prototype._t=function(t,n){var i=B(),e="",e=this.env%2===r.BROWSER?"rtc":"ali";return n=Wt(Wt({},n),{time:i,level:t,console:e,appid:this.appid,room_id:this.roomid,roomid:this.roomid,userid:this.userid,id_name:this.userid,userName:this.userName,sessionid:this.sessionid,sdk_version:this.version,test_environment:this.stateCenter.testEnvironment,version:this.version,event_id:this.appid+"_"+this.userid+"_"+n.event_time+"_"+n.seq}),JSON.stringify(n)},q.prototype.Dt=function(){0!=this.Rt.size()&&(this.env%2===r.BROWSER?this.Wt():this.SendHttpsLogWeChatMini())},q.prototype.Wt=function(){var n=this,t=this.Rt.buffer.join("\n"),i=this.Rt.buffer,e=new XMLHttpRequest;e.onreadystatechange=function(){if(4==e.readyState){if(200==e.status){if(0==e.responseText.length)return;try{var t=JSON.parse(e.responseText).interval;"number"==typeof t&&n.logUploadInterval!==t&&(n.timeInterval=t,n.Nt(n.url))}catch(t){n.Rt.buffer=i.concat(n.Rt.buffer),console.log("send result failed "+t)}}else n.Rt.buffer=i.concat(n.Rt.buffer),console.log("send failed "+e.status);i=null}},e.open("POST",this.url,!0),0==this.env?e.send(t):1==this.env&&(e.setRequestHeader("content-type","application/json"),e.send(JSON.stringify({user_id:this.userid,log:t}))),this.Rt.buffer=[]},q.prototype.SendHttpsLogWeChatMini=function(){},q.prototype.destroy=function(){this.Tt(),this.logUploadTimer&&clearTimeout(this.logUploadTimer),C.instance=void 0,this.Pt.destroy(),this.xt&&this.xt.destroy(),this.url="",this.isDestroy=!0},q.logVersion="1.4.5",q);function q(t,n){var i=this;this.proxyCtrl=n,this.logLevel=s.INFO,this.logRemoteLevel=0,this.logUploadTimer=null,this.logUploadInterval=1e4,this.existUserID=!1,this.isDestroy=!1,this.Ct=8192,this.D={debug:function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];i.debug.apply(i,t)},info:function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];i.info.apply(i,t)},warn:function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];i.warn.apply(i,t)},error:function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];i.error.apply(i,t)}},this.stateCenter=C.getInstance(),this.j=new dt,this.j.env=t,this.Rt=new mt(this.j),this.Pt=new X(this.Rt,this.j,this.D,this.proxyCtrl),this.env==r.BROWSER&&Lt.isEnvSupport()&&(this.xt=new Lt(this.j,this.proxyCtrl))}}],o={},r.m=e,r.c=o,r.d=function(t,n,i){r.o(t,n)||Object.defineProperty(t,n,{enumerable:!0,get:i})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"Bt",{value:!0})},r.t=function(n,t){if(1&t&&(n=r(n)),8&t)return n;if(4&t&&"object"==typeof n&&n&&n.Bt)return n;var i=Object.create(null);if(r.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:n}),2&t&&"string"!=typeof n)for(var e in n)r.d(i,e,function(t){return n[t]}.bind(null,e));return i},r.n=function(t){var n=t&&t.Bt?function(){return t.default}:function(){return t};return r.d(n,"a",n),n},r.o=function(t,n){return Object.prototype.hasOwnProperty.call(t,n)},r.p="",r(r.s=2);function r(t){var n;return(o[t]||(n=o[t]={i:t,l:!1,exports:{}},e[t].call(n.exports,n,n.exports,r),n.l=!0,n)).exports}var e,o});