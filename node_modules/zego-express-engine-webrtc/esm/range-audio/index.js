!function(t,i){if("object"==typeof exports&&"object"==typeof module)module.exports=i();else if("function"==typeof define&&define.amd)define([],i);else{var n=i();for(var r in n)("object"==typeof exports?exports:t)[r]=n[r]}}("undefined"!=typeof self?self:this,(function(){return function(){var t={3720:function(t){t.exports=n;var i=null;try{i=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch(t){}function n(t,i,n){this.low=0|t,this.high=0|i,this.unsigned=!!n}function r(t){return!0===(t&&t.__isLong__)}Object.defineProperty(n.prototype,"__isLong__",{value:!0}),n.isLong=r;var e={},s={};function o(t,i){var n,r,o;return i?(o=0<=(t>>>=0)&&t<256)&&(r=s[t])?r:(n=h(t,(0|t)<0?-1:0,!0),o&&(s[t]=n),n):(o=-128<=(t|=0)&&t<128)&&(r=e[t])?r:(n=h(t,t<0?-1:0,!1),o&&(e[t]=n),n)}function u(t,i){if(isNaN(t))return i?m:w;if(i){if(t<0)return m;if(t>=d)return k}else{if(t<=-v)return x;if(t+1>=v)return E}return t<0?u(-t,i).neg():h(t%l|0,t/l|0,i)}function h(t,i,r){return new n(t,i,r)}n.fromInt=o,n.fromNumber=u,n.fromBits=h;var a=Math.pow;function c(t,i,n){if(0===t.length)throw Error("empty string");if("NaN"===t||"Infinity"===t||"+Infinity"===t||"-Infinity"===t)return w;if("number"==typeof i?(n=i,i=!1):i=!!i,(n=n||10)<2||36<n)throw RangeError("radix");var r;if((r=t.indexOf("-"))>0)throw Error("interior hyphen");if(0===r)return c(t.substring(1),i,n).neg();for(var e=u(a(n,8)),s=w,o=0;o<t.length;o+=8){var h=Math.min(8,t.length-o),f=parseInt(t.substring(o,o+h),n);if(h<8){var l=u(a(n,h));s=s.mul(l).add(u(f))}else s=(s=s.mul(e)).add(u(f))}return s.unsigned=i,s}function f(t,i){return"number"==typeof t?u(t,i):"string"==typeof t?c(t,i):h(t.low,t.high,"boolean"==typeof i?i:t.unsigned)}n.fromString=c,n.fromValue=f;var l=4294967296,d=l*l,v=d/2,p=o(1<<24),w=o(0);n.ZERO=w;var m=o(0,!0);n.UZERO=m;var y=o(1);n.ONE=y;var b=o(1,!0);n.UONE=b;var g=o(-1);n.NEG_ONE=g;var E=h(-1,2147483647,!1);n.MAX_VALUE=E;var k=h(-1,-1,!0);n.MAX_UNSIGNED_VALUE=k;var x=h(0,-2147483648,!1);n.MIN_VALUE=x;var S=n.prototype;S.toInt=function(){return this.unsigned?this.low>>>0:this.low},S.toNumber=function(){return this.unsigned?(this.high>>>0)*l+(this.low>>>0):this.high*l+(this.low>>>0)},S.toString=function(t){if((t=t||10)<2||36<t)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative()){if(this.eq(x)){var i=u(t),n=this.div(i),r=n.mul(i).sub(this);return n.toString(t)+r.toInt().toString(t)}return"-"+this.neg().toString(t)}for(var e=u(a(t,6),this.unsigned),s=this,o="";;){var h=s.div(e),c=(s.sub(h.mul(e)).toInt()>>>0).toString(t);if((s=h).isZero())return c+o;for(;c.length<6;)c="0"+c;o=""+c+o}},S.getHighBits=function(){return this.high},S.getHighBitsUnsigned=function(){return this.high>>>0},S.getLowBits=function(){return this.low},S.getLowBitsUnsigned=function(){return this.low>>>0},S.getNumBitsAbs=function(){if(this.isNegative())return this.eq(x)?64:this.neg().getNumBitsAbs();for(var t=0!=this.high?this.high:this.low,i=31;i>0&&0==(t&1<<i);i--);return 0!=this.high?i+33:i+1},S.isZero=function(){return 0===this.high&&0===this.low},S.eqz=S.isZero,S.isNegative=function(){return!this.unsigned&&this.high<0},S.isPositive=function(){return this.unsigned||this.high>=0},S.isOdd=function(){return 1==(1&this.low)},S.isEven=function(){return 0==(1&this.low)},S.equals=function(t){return r(t)||(t=f(t)),(this.unsigned===t.unsigned||this.high>>>31!=1||t.high>>>31!=1)&&(this.high===t.high&&this.low===t.low)},S.eq=S.equals,S.notEquals=function(t){return!this.eq(t)},S.neq=S.notEquals,S.ne=S.notEquals,S.lessThan=function(t){return this.comp(t)<0},S.lt=S.lessThan,S.lessThanOrEqual=function(t){return this.comp(t)<=0},S.lte=S.lessThanOrEqual,S.le=S.lessThanOrEqual,S.greaterThan=function(t){return this.comp(t)>0},S.gt=S.greaterThan,S.greaterThanOrEqual=function(t){return this.comp(t)>=0},S.gte=S.greaterThanOrEqual,S.ge=S.greaterThanOrEqual,S.compare=function(t){if(r(t)||(t=f(t)),this.eq(t))return 0;var i=this.isNegative(),n=t.isNegative();return i&&!n?-1:!i&&n?1:this.unsigned?t.high>>>0>this.high>>>0||t.high===this.high&&t.low>>>0>this.low>>>0?-1:1:this.sub(t).isNegative()?-1:1},S.comp=S.compare,S.negate=function(){return!this.unsigned&&this.eq(x)?x:this.not().add(y)},S.neg=S.negate,S.add=function(t){r(t)||(t=f(t));var i=0,n=0,e=0,s=0;return e+=(s+=(65535&this.low)+(65535&t.low))>>>16,n+=(e+=(this.low>>>16)+(t.low>>>16))>>>16,i+=(n+=(65535&this.high)+(65535&t.high))>>>16,i+=(this.high>>>16)+(t.high>>>16),h((e&=65535)<<16|(s&=65535),(i&=65535)<<16|(n&=65535),this.unsigned)},S.subtract=function(t){return r(t)||(t=f(t)),this.add(t.neg())},S.sub=S.subtract,S.multiply=function(t){if(this.isZero())return w;if(r(t)||(t=f(t)),i)return h(i.mul(this.low,this.high,t.low,t.high),i.get_high(),this.unsigned);if(t.isZero())return w;if(this.eq(x))return t.isOdd()?x:w;if(t.eq(x))return this.isOdd()?x:w;if(this.isNegative())return t.isNegative()?this.neg().mul(t.neg()):this.neg().mul(t).neg();if(t.isNegative())return this.mul(t.neg()).neg();if(this.lt(p)&&t.lt(p))return u(this.toNumber()*t.toNumber(),this.unsigned);var n=65535&this.high,e=this.low>>>16,s=65535&this.low,o=65535&t.high,a=t.low>>>16,c=65535&t.low,l=0,d=0,v=0,m=0;return v+=(m+=s*c)>>>16,d+=(v+=e*c)>>>16,v&=65535,d+=(v+=s*a)>>>16,l+=(d+=n*c)>>>16,d&=65535,l+=(d+=e*a)>>>16,d&=65535,l+=(d+=s*o)>>>16,l+=(this.high>>>16)*c+n*a+e*o+s*(t.high>>>16),h((v&=65535)<<16|(m&=65535),(l&=65535)<<16|(d&=65535),this.unsigned)},S.mul=S.multiply,S.divide=function(t){if(r(t)||(t=f(t)),t.isZero())throw Error("division by zero");var n,e,s;if(i)return this.unsigned||-2147483648!==this.high||-1!==t.low||-1!==t.high?h((this.unsigned?i.div_u:i.div_s)(this.low,this.high,t.low,t.high),i.get_high(),this.unsigned):this;if(this.isZero())return this.unsigned?m:w;if(this.unsigned){if(t.unsigned||(t=t.toUnsigned()),t.gt(this))return m;if(t.gt(this.shru(1)))return b;s=m}else{if(this.eq(x))return t.eq(y)||t.eq(g)?x:t.eq(x)?y:(n=this.shr(1).div(t).shl(1)).eq(w)?t.isNegative()?y:g:(e=this.sub(t.mul(n)),s=n.add(e.div(t)));if(t.eq(x))return this.unsigned?m:w;if(this.isNegative())return t.isNegative()?this.neg().div(t.neg()):this.neg().div(t).neg();if(t.isNegative())return this.div(t.neg()).neg();s=w}for(e=this;e.gte(t);){n=Math.max(1,Math.floor(e.toNumber()/t.toNumber()));for(var o=Math.ceil(Math.log(n)/Math.LN2),c=o<=48?1:a(2,o-48),l=u(n),d=l.mul(t);d.isNegative()||d.gt(e);)d=(l=u(n-=c,this.unsigned)).mul(t);l.isZero()&&(l=y),s=s.add(l),e=e.sub(d)}return s},S.div=S.divide,S.modulo=function(t){return r(t)||(t=f(t)),i?h((this.unsigned?i.rem_u:i.rem_s)(this.low,this.high,t.low,t.high),i.get_high(),this.unsigned):this.sub(this.div(t).mul(t))},S.mod=S.modulo,S.rem=S.modulo,S.not=function(){return h(~this.low,~this.high,this.unsigned)},S.and=function(t){return r(t)||(t=f(t)),h(this.low&t.low,this.high&t.high,this.unsigned)},S.or=function(t){return r(t)||(t=f(t)),h(this.low|t.low,this.high|t.high,this.unsigned)},S.xor=function(t){return r(t)||(t=f(t)),h(this.low^t.low,this.high^t.high,this.unsigned)},S.shiftLeft=function(t){return r(t)&&(t=t.toInt()),0==(t&=63)?this:t<32?h(this.low<<t,this.high<<t|this.low>>>32-t,this.unsigned):h(0,this.low<<t-32,this.unsigned)},S.shl=S.shiftLeft,S.shiftRight=function(t){return r(t)&&(t=t.toInt()),0==(t&=63)?this:t<32?h(this.low>>>t|this.high<<32-t,this.high>>t,this.unsigned):h(this.high>>t-32,this.high>=0?0:-1,this.unsigned)},S.shr=S.shiftRight,S.shiftRightUnsigned=function(t){if(r(t)&&(t=t.toInt()),0===(t&=63))return this;var i=this.high;return t<32?h(this.low>>>t|i<<32-t,i>>>t,this.unsigned):h(32===t?i:i>>>t-32,0,this.unsigned)},S.shru=S.shiftRightUnsigned,S.shr_u=S.shiftRightUnsigned,S.toSigned=function(){return this.unsigned?h(this.low,this.high,!1):this},S.toUnsigned=function(){return this.unsigned?this:h(this.low,this.high,!0)},S.toBytes=function(t){return t?this.toBytesLE():this.toBytesBE()},S.toBytesLE=function(){var t=this.high,i=this.low;return[255&i,i>>>8&255,i>>>16&255,i>>>24,255&t,t>>>8&255,t>>>16&255,t>>>24]},S.toBytesBE=function(){var t=this.high,i=this.low;return[t>>>24,t>>>16&255,t>>>8&255,255&t,i>>>24,i>>>16&255,i>>>8&255,255&i]},n.fromBytes=function(t,i,r){return r?n.fromBytesLE(t,i):n.fromBytesBE(t,i)},n.fromBytesLE=function(t,i){return new n(t[0]|t[1]<<8|t[2]<<16|t[3]<<24,t[4]|t[5]<<8|t[6]<<16|t[7]<<24,i)},n.fromBytesBE=function(t,i){return new n(t[4]<<24|t[5]<<16|t[6]<<8|t[7],t[0]<<24|t[1]<<16|t[2]<<8|t[3],i)}},6331:function(t,i,n){"use strict";var r,e,s,o;n.d(i,{BI:function(){return o},VO:function(){return s},tp:function(){return r},vy:function(){return e}}),function(t){t[t.Off=0]="Off",t[t.TurningOn=1]="TurningOn",t[t.On=2]="On"}(r||(r={})),function(t){t[t.World=0]="World",t[t.Team=1]="Team",t[t.SecretTeam=2]="SecretTeam"}(e||(e={})),function(t){t[t.All=0]="All",t[t.World=1]="World",t[t.Team=2]="Team"}(s||(s={})),function(t){t[t.All=0]="All",t[t.World=1]="World",t[t.Team=2]="Team"}(o||(o={}))},3189:function(t,i,n){"use strict";var r,e,s,o;n.d(i,{ZD:function(){return o}}),function(t){t[t.NONE=0]="NONE",t[t.MEN_TO_CHILD=1]="MEN_TO_CHILD",t[t.MEN_TO_WOMEN=2]="MEN_TO_WOMEN",t[t.WOMEN_TO_CHILD=3]="WOMEN_TO_CHILD",t[t.WOMEN_TO_MEN=4]="WOMEN_TO_MEN",t[t.FOREIGNER=5]="FOREIGNER",t[t.OPTIMUS_PRIME=6]="OPTIMUS_PRIME",t[t.ANDROID=7]="ANDROID",t[t.ETHEREAL=8]="ETHEREAL",t[t.MALE_MAGNETIC=9]="MALE_MAGNETIC",t[t.FEMALE_FRESH=10]="FEMALE_FRESH",t[t.MAJOR_C=11]="MAJOR_C",t[t.MINOR_A=12]="MINOR_A",t[t.HARMONIC_MINOR=13]="HARMONIC_MINOR",t[t.FEMALE_ENERGETIC=14]="FEMALE_ENERGETIC",t[t.RICHNESS=15]="RICHNESS",t[t.MUFFLED=16]="MUFFLED",t[t.ROUNDNESS=17]="ROUNDNESS",t[t.FALSETTO=18]="FALSETTO",t[t.FULLNESS=19]="FULLNESS",t[t.CLEAR=20]="CLEAR",t[t.HIGHLY_RESONANT=21]="HIGHLY_RESONANT",t[t.LOUD_CLEAR=22]="LOUD_CLEAR"}(r||(r={})),function(t){t[t.None=0]="None",t[t.SoftRoom=1]="SoftRoom",t[t.LargeRoom=2]="LargeRoom",t[t.ConcertHall=3]="ConcertHall",t[t.Valley=4]="Valley",t[t.RecordingStudio=5]="RecordingStudio",t[t.Basement=6]="Basement",t[t.KTV=7]="KTV",t[t.Popular=8]="Popular",t[t.Rock=9]="Rock",t[t.VocalConcert=10]="VocalConcert",t[t.GramoPhone=11]="GramoPhone",t[t.EnhancedKTV=12]="EnhancedKTV"}(e||(e={})),function(t){t[t.None=0]="None",t[t.Local=1]="Local",t[t.Publish=2]="Publish",t[t.All=3]="All"}(s||(s={})),function(t){t[t.AI=0]="AI",t[t.AIBalanced=1]="AIBalanced"}(o||(o={}))},1945:function(t,i,n){"use strict";n(6306)},6306:function(t,i,n){"use strict";n.d(i,{$E:function(){return v},Au:function(){return e},E3:function(){return a},Fq:function(){return w},GJ:function(){return r},Qx:function(){return d},b0:function(){return f},eW:function(){return p},i7:function(){return u},ij:function(){return s},tq:function(){return h},v4:function(){return l},wM:function(){return c}});n(3720),n(1945);var r=Promise,e=document;function s(){return navigator.userAgent||""}function o(){var t,i=navigator.userAgent,n=i.match(/(opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*([\d\.]+)/i)||[];return/trident/i.test(n[1])?{name:"IE",version:(t=/\brv[ :]+([\d\.]+)/g.exec(i)||[])[1]||""}:"Chrome"===n[1]&&null!=(t=i.match(/\bOPR|Edge\/([\d\.]+)/))?{name:"Opera",version:t[1]}:(n=n[2]?[n[1],n[2]]:[navigator.appName,navigator.appVersion,"-?"],null!=(t=i.match(/version\/([\d+\.]+)/i))&&n.splice(1,1,t[1]),{name:n[0],version:n[1]})}function u(){return"chrome"==o().name.toLowerCase()}function h(){var t=s();return!!(t.match(/Mobi/i)||t.match(/Android/i)||t.match(/iPhone/i))}var a="room not exist",c="device is not found",f="stream is not from zego",l="input param error",d="local stream wrong",v="no preview",p="publish stream no found",w="network is broken"},9399:function(t,i,n){"use strict";function r(t){return"number"==typeof t}function e(t){return"string"==typeof t}function s(t){return"boolean"==typeof t}function o(t){return void 0===t}function u(t){return"function"==typeof t}function h(t){return t instanceof HTMLMediaElement}n.d(i,{Qo:function(){return o},Rk:function(){return e},UH:function(){return r},ZF:function(){return h},ZV:function(){return s},ae:function(){return u}})}},i={};function n(r){var e=i[r];if(void 0!==e)return e.exports;var s=i[r]={exports:{}};return t[r](s,s.exports,n),s.exports}n.n=function(t){var i=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(i,{a:i}),i},n.d=function(t,i){for(var r in i)n.o(i,r)&&!n.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:i[r]})},n.o=function(t,i){return Object.prototype.hasOwnProperty.call(t,i)},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})};var r={};return function(){"use strict";n.r(r),n.d(r,{RangeAudio:function(){return $}});var t=n(6331),i=n(6306),e=function(){function t(){}return t.generateEls=function(t){if(void 0===t&&(t=30),this.elements.length>=t)this.elements.forEach((function(t){t.dom.play().catch((function(t){}))}));else{var n=Array(t-this.elements.length).fill(0).map((function(t,n){var r=i.Au.createElement("audio");return r.muted=!0,r.setAttribute("autoplay","autoplay"),r.setAttribute("playsInline","playsInline"),r.id="audio"+n,{dom:r,id:n,used:!1}}));this.elements=this.elements.concat(n)}},t.useAudioEl=function(){0===this.elements.length&&this.generateEls();var t=this.elements.find((function(t){return!t.used}));return t&&(t.used=!0),t},t.stopUsingAudioEl=function(t){var i=this.elements[t];i&&(i.dom.onpause=null,i.dom.onerror=null,i.dom.muted=!0,i.used=!1)},t.elements=[],t}(),s=function(t,i,n,r){return new(n||(n=Promise))((function(e,s){function o(t){try{h(r.next(t))}catch(t){s(t)}}function u(t){try{h(r.throw(t))}catch(t){s(t)}}function h(t){var i;t.done?e(t.value):(i=t.value,i instanceof n?i:new n((function(t){t(i)}))).then(o,u)}h((r=r.apply(t,i||[])).next())}))},o=function(t,i){var n,r,e,s,o={label:0,sent:function(){if(1&e[0])throw e[1];return e[1]},trys:[],ops:[]};return s={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function u(u){return function(h){return function(u){if(n)throw new TypeError("Generator is already executing.");for(;s&&(s=0,u[0]&&(o=0)),o;)try{if(n=1,r&&(e=2&u[0]?r.return:u[0]?r.throw||((e=r.return)&&e.call(r),0):r.next)&&!(e=e.call(r,u[1])).done)return e;switch(r=0,e&&(u=[2&u[0],e.value]),u[0]){case 0:case 1:e=u;break;case 4:return o.label++,{value:u[1],done:!1};case 5:o.label++,r=u[1],u=[0];continue;case 7:u=o.ops.pop(),o.trys.pop();continue;default:if(!(e=o.trys,(e=e.length>0&&e[e.length-1])||6!==u[0]&&2!==u[0])){o=0;continue}if(3===u[0]&&(!e||u[1]>e[0]&&u[1]<e[3])){o.label=u[1];break}if(6===u[0]&&o.label<e[1]){o.label=e[1],e=u;break}if(e&&o.label<e[2]){o.label=e[2],o.ops.push(u);break}e[2]&&o.ops.pop(),o.trys.pop();continue}u=i.call(t,o)}catch(t){u=[6,t],r=0}finally{n=e=0}if(5&u[0])throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}([u,h])}}},u="zc.ra.3",h=function(){function t(t,i){this.t=t,this.i=i,this.rtcConn=null,this.loopbackConn=null,this.destStream=new MediaStream,this.onError=null}return t.prototype.bindStream=function(t,i){var n,r;return s(this,void 0,void 0,(function(){var e,s,h,a,c,f,l=this;return o(this,(function(o){switch(o.label){case 0:return i&&(this.t=i),e=["completed","connected"],this.rtcConn&&this.loopbackConn&&e.includes(this.rtcConn.connectionState)?(s=null===(n=this.rtcConn)||void 0===n?void 0:n.getSenders().find((function(t){var i;return"audio"===(null===(i=t.track)||void 0===i?void 0:i.kind)})),t.getTracks().forEach((function(t){"audio"===t.kind&&(null==s||s.replaceTrack(t))})),[3,10]):[3,1];case 1:this.rtcConn=new RTCPeerConnection,this.loopbackConn=new RTCPeerConnection,h={offerVideo:!0,offerAudio:!0,offerToReceiveAudio:!1,offerToReceiveVideo:!1},this.rtcConn.onicecandidateerror=function(t){l.i.warn(u+" ".concat(l.t," loopback in ice error: ").concat(JSON.stringify(t)))},this.loopbackConn.onicecandidateerror=function(t){l.i.warn(u+" ".concat(l.t," loopback out ice error: ").concat(JSON.stringify(t)))},this.rtcConn.onicecandidate=function(t){var i,n=t.candidate;n&&(l.i.info(u+" ".concat(l.t," loopback add out candidate: ").concat(n)),null===(i=l.loopbackConn)||void 0===i||i.addIceCandidate(new RTCIceCandidate(n)))},this.loopbackConn.onicecandidate=function(t){var i,n=t.candidate;n&&(l.i.info(u+" ".concat(l.t," loopback add in candidate: ").concat(n)),null===(i=l.rtcConn)||void 0===i||i.addIceCandidate(new RTCIceCandidate(n)))},window.setTimeout((function(){l.rtcConn&&l.loopbackConn&&(e.includes(l.rtcConn.iceConnectionState)&&e.includes(l.loopbackConn.iceConnectionState)?l.i.info(u+" ".concat(l.t," loopback connect ok.")):(l.i.warn(u+" ".concat(l.t," loopback connect failed. in state: ").concat(l.rtcConn.iceConnectionState,", out state: ").concat(l.loopbackConn.iceConnectionState)),l.close(),l.onError&&l.onError("time out")))}),2e3),this.loopbackConn.ontrack=function(t){var i=t.track;l.i.info(u+" ".concat(l.t," loopback receive track")),l.replaceTrack(i)},t.getTracks().find((function(i){var n;if("audio"===i.kind)return null===(n=l.rtcConn)||void 0===n||n.addTrack(i,t),!0})),o.label=2;case 2:return o.trys.push([2,9,,10]),[4,this.rtcConn.createOffer(h)];case 3:return a=o.sent(),[4,this.rtcConn.setLocalDescription(a)];case 4:return o.sent(),[4,this.loopbackConn.setRemoteDescription(a)];case 5:return o.sent(),[4,this.loopbackConn.createAnswer()];case 6:return(c=o.sent()).sdp=null===(r=c.sdp)||void 0===r?void 0:r.replace(/useinbandfec=/,"stereo=1;useinbandfec="),[4,this.loopbackConn.setLocalDescription(c)];case 7:return o.sent(),[4,this.rtcConn.setRemoteDescription(c)];case 8:return o.sent(),this.i.info(u+" ".concat(this.t," loopback set sdp completed.")),[3,10];case 9:return f=o.sent(),this.i.error(u+" ".concat(this.t," loopback connect failed.").concat(f)),this.close(),this.onError&&this.onError("connect failed"),this.onError=null,[3,10];case 10:return[2,this.destStream]}}))}))},t.prototype.replaceTrack=function(t){var i=this;"audio"===t.kind&&(this.destStream.getTracks().forEach((function(t){i.destStream.removeTrack(t)})),this.destStream.addTrack(t))},t.prototype.close=function(){var t=this,i=this.rtcConn,n=this.loopbackConn;this.destStream.getTracks().forEach((function(i){t.destStream.removeTrack(i)})),null==i||i.close(),null==n||n.close(),this.rtcConn=null,this.loopbackConn=null},t}();var a=n(9399),c=function(t,i,n,r){return new(n||(n=Promise))((function(e,s){function o(t){try{h(r.next(t))}catch(t){s(t)}}function u(t){try{h(r.throw(t))}catch(t){s(t)}}function h(t){var i;t.done?e(t.value):(i=t.value,i instanceof n?i:new n((function(t){t(i)}))).then(o,u)}h((r=r.apply(t,i||[])).next())}))},f=function(t,i){var n,r,e,s,o={label:0,sent:function(){if(1&e[0])throw e[1];return e[1]},trys:[],ops:[]};return s={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function u(u){return function(h){return function(u){if(n)throw new TypeError("Generator is already executing.");for(;s&&(s=0,u[0]&&(o=0)),o;)try{if(n=1,r&&(e=2&u[0]?r.return:u[0]?r.throw||((e=r.return)&&e.call(r),0):r.next)&&!(e=e.call(r,u[1])).done)return e;switch(r=0,e&&(u=[2&u[0],e.value]),u[0]){case 0:case 1:e=u;break;case 4:return o.label++,{value:u[1],done:!1};case 5:o.label++,r=u[1],u=[0];continue;case 7:u=o.ops.pop(),o.trys.pop();continue;default:if(!(e=o.trys,(e=e.length>0&&e[e.length-1])||6!==u[0]&&2!==u[0])){o=0;continue}if(3===u[0]&&(!e||u[1]>e[0]&&u[1]<e[3])){o.label=u[1];break}if(6===u[0]&&o.label<e[1]){o.label=e[1],e=u;break}if(e&&o.label<e[2]){o.label=e[2],o.ops.push(u);break}e[2]&&o.ops.pop(),o.trys.pop();continue}u=i.call(t,o)}catch(t){u=[6,t],r=0}finally{n=e=0}if(5&u[0])throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}([u,h])}}},l="zc.ra.5";var d,v=function(){function t(t,i){this.i=t,this.userID="base"+(new Date).getTime(),this.isHide=!1,this.distance=null,this.maxDistance=1e3,this.position=null,this.speaker="",this.audioEl=null,this.sourceNode=null,this.isPlaying=!1,this.config={needLoopback:!0,useGain:!0,playOnAudioContext:!1,useWebAudio:!0},this.volume=1,this.gainNode=null,this.isSpatial=!1,this.panner=null,this.audioCtx=i.audioCtx,this.isSpatial=i.isSpatial,this.setMaxDistance((0,a.UH)(i.maxDistance)?i.maxDistance:1e5),this.destNode=this.audioCtx.createMediaStreamDestination(),this.setVolume(i.volume),this.setSpeaker(i.speaker).catch((function(t){})),this.inBackground(i.isHide)}return t.prototype.setPosition=function(t){this.i.info(l+" ".concat(this.userID," set position: ")+t),this.position=t,this.panner&&(void 0!==this.panner.positionX?(this.panner.positionX.value=t[1],this.panner.positionY.value=t[2],this.panner.positionZ.value=-t[0]):this.panner.setPosition(t[1],t[2],-t[0]))},t.prototype.getDistanceFromListener=function(t){return this.distance=function(t,i){if(!i||!t)return null;var n=[t[0]-i[0],t[1]-i[1],t[2]-i[2]];return Math.sqrt(Math.pow(n[0],2)+Math.pow(n[1],2)+Math.pow(n[2],2))}(this.position,t.position),this.distance},t.prototype.setMaxDistance=function(t){this.maxDistance=t,this.panner&&(t<10&&(t=10),this.panner.maxDistance=2.6*t)},t.prototype.setVolume=function(t){isNaN(t)||(this.volume=t,this.gainNode&&(this.gainNode.gain.value=this.volume))},t.prototype.setSpeaker=function(t){var i;return c(this,void 0,void 0,(function(){var n,r,e;return f(this,(function(s){switch(s.label){case 0:if(!(0,a.Rk)(t))return[2];if(this.speaker=t,!(n=null===(i=this.audioEl)||void 0===i?void 0:i.dom))return[3,10];if(!(r=n.setSinkId))return[3,8];s.label=1;case 1:return s.trys.push([1,6,,7]),this.config.playOnAudioContext?[3,3]:[4,r.call(n,t||"")];case 2:return s.sent(),[3,5];case 3:return[4,r.call(n,"")];case 4:s.sent(),s.label=5;case 5:return this.i.info(l+" ".concat(this.userID," set speaker success. id: ").concat(t,".")),[3,7];case 6:throw e=s.sent(),this.i.error(l+" ".concat(this.userID," set speaker failed. id: ").concat(t,"  error: ").concat(e,".")),e;case 7:return[3,9];case 8:throw"setting speaker not support.";case 9:return[3,11];case 10:this.i.info(l+" ".concat(this.userID," no element for set speaker.")),s.label=11;case 11:return[2]}}))}))},t.prototype.initPanner=function(){if(!this.panner){var t=function(t,i,n){var r=n||[0,0,0],e=t.createPanner(),s=t.createGain();return e.panningModel="HRTF",e.distanceModel="linear",e.refDistance=1,e.maxDistance=2.6*i||1,e.rolloffFactor=1,e.coneOuterGain=.4,void 0!==e.positionX?(e.positionX.value=r[1],e.positionY.value=r[2],e.positionZ.value=-r[0]):e.setPosition(r[1],r[2],-r[0]),{panner:e,gainNode:s}}(this.audioCtx,this.maxDistance,this.position),i=t.gainNode;this.panner=t.panner,this.gainNode=i,i.gain.value=this.volume}},t.prototype.changeRenderConfig=function(t,n,r,e){var s,o,u,a,d;return void 0===n&&(n=!1),void 0===r&&(r=!1),void 0===e&&(e=!0),c(this,void 0,void 0,(function(){var c,v,p,w,m,y,b,g,E,k,x,S,O=this;return f(this,(function(f){switch(f.label){case 0:return n||this.isSpatial!==t?(this.isSpatial=t,c=(0,i.i7)()&&(0,i.tq)(),[4,q()]):[2];case 1:return v=f.sent(),p="Windows"===v.platform&&v.majorPlatformVersion>=13,w=this.isHide&&(p||c),m="running"!==this.audioCtx.state,e&&(w||m)&&(this.i.warn("".concat(l," ").concat(this.userID," stop web audio. system: ").concat(v.platform," ").concat(v.majorPlatformVersion)),e=!1),this.config.useWebAudio=e,y=(0,i.ij)(),b=y.includes("safari")&&!y.includes("chrome"),g=y.includes("micromessenger")&&new RegExp(/(iphone|ipad|ipod|ios)/i).test(y),e||this.stream||(r=!0),this.config.playOnAudioContext=r,this.initPanner(),this.isPlaying&&this.sourceNode?(this.lastNode&&this.lastNode.disconnect(),E=this.sourceNode,this.sourceNode.disconnect(),null===(s=this.panner)||void 0===s||s.disconnect(),null===(o=this.gainNode)||void 0===o||o.disconnect(),this.gainNode?(e&&(this.config.useGain&&(E=this.sourceNode.connect(this.gainNode)),this.panner&&t&&(E=E.connect(this.panner))),E.connect(r?this.audioCtx.destination:this.destNode),this.lastNode=E,this.position&&this.setPosition(this.position),this.i.info(l+" '".concat(this.userID,"' play ").concat(t?"3d":"normal"," stream on ").concat(r?"audio ctx":"element")),(k=null===(u=this.audioEl)||void 0===u?void 0:u.dom)?(k.onpause=function(){O.i.warn(l+" ".concat(O.streamID," audio paused"))},k.onerror=function(t){O.i.warn(l+" ".concat(O.streamID," audio error, ").concat(t))},r?(this.stream&&k.srcObject!==this.stream&&(k.srcObject=this.stream,k.muted=!0,k.oncanplay=function(){k.play().then((function(){O.i.info(l+" ".concat(O.userID," ctx autoplay success.")),O.checkPlayStatus()})).catch((function(t){O.i.warn(l+" ".concat(O.userID," ctx autoplay failed."))}))}),[3,6]):[3,2]):[3,6]):[3,6]):[3,6];case 2:return x=this.destNode.stream,(S=this.config.needLoopback&&!g&&!b)&&this.loopbackConn&&(this.loopbackConn.close(),this.loopbackConn.onError=null),e||!this.stream?[3,3]:(this.i.info("".concat(l," ").concat(this.userID," stop audio api")),this.sourceNode.disconnect(),null===(a=this.panner)||void 0===a||a.disconnect(),null===(d=this.gainNode)||void 0===d||d.disconnect(),x=this.stream,[3,5]);case 3:return S&&x?(this.loopbackConn=this.loopbackConn||new h(this.streamID||"",this.i),this.loopbackConn.onError=function(t){O.i.warn(l+" ".concat(O.userID," loopback failed! ").concat(t)),O.changeRenderConfig(O.isSpatial,!0,!0)},[4,this.loopbackConn.bindStream(x,this.streamID||void 0)]):[3,5];case 4:return x=f.sent(),[3,5];case 5:k.muted=!0,k.srcObject=x,this.setSpeaker(this.speaker).catch((function(t){})),k.oncanplay=function(){if(k){k.muted=!1;var t=function(t){O.i.error(l+" ".concat(O.userID," autoplay failed. error: ").concat(t)),O.changeRenderConfig(O.isSpatial,!0,!0)};k.play().then((function(){(null==k?void 0:k.paused)?t("audio paused"):(O.i.info(l+" ".concat(O.userID," element autoplay success.")),O.checkPlayStatus())})).catch((function(i){t(i)}))}},f.label=6;case 6:return[2]}}))}))},t.prototype.checkPlayStatus=function(){var t=this;setTimeout((function(){var i;if(t.isPlaying){var n=null===(i=t.audioEl)||void 0===i?void 0:i.dom,r=t.audioCtx.state;!n||n.paused||n.muted&&!t.config.playOnAudioContext||"running"!==r?(t.i.warn("".concat(l," ").concat(t.userID," play detection is abnormal. audio ctx:").concat(r,", paused:").concat(null==n?void 0:n.paused,", muted:").concat(null==n?void 0:n.muted)),"running"!==r&&(t.audioCtx.resume(),setTimeout((function(){t.i.warn("".concat(l," ").concat(t.userID," play resume. audio ctx:").concat(r,", paused:").concat(null==n?void 0:n.paused,", muted:").concat(null==n?void 0:n.muted))}),1e3))):t.i.info("".concat(l," ").concat(t.userID," play detection is fine"))}}),2e3)},t.prototype.inBackground=function(t,i){void 0===t&&(t=!1),void 0===i&&(i=!1),this.isHide!==t&&(this.isHide=t,t||this.config.useWebAudio||this.changeRenderConfig(this.isSpatial,!0))},t}(),p=(d=function(t,i){return d=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,i){t.__proto__=i}||function(t,i){for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(t[n]=i[n])},d(t,i)},function(t,i){if("function"!=typeof i&&null!==i)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");function n(){this.constructor=t}d(t,i),t.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}),w=function(t,i,n,r){return new(n||(n=Promise))((function(e,s){function o(t){try{h(r.next(t))}catch(t){s(t)}}function u(t){try{h(r.throw(t))}catch(t){s(t)}}function h(t){var i;t.done?e(t.value):(i=t.value,i instanceof n?i:new n((function(t){t(i)}))).then(o,u)}h((r=r.apply(t,i||[])).next())}))},m=function(t,i){var n,r,e,s,o={label:0,sent:function(){if(1&e[0])throw e[1];return e[1]},trys:[],ops:[]};return s={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function u(u){return function(h){return function(u){if(n)throw new TypeError("Generator is already executing.");for(;s&&(s=0,u[0]&&(o=0)),o;)try{if(n=1,r&&(e=2&u[0]?r.return:u[0]?r.throw||((e=r.return)&&e.call(r),0):r.next)&&!(e=e.call(r,u[1])).done)return e;switch(r=0,e&&(u=[2&u[0],e.value]),u[0]){case 0:case 1:e=u;break;case 4:return o.label++,{value:u[1],done:!1};case 5:o.label++,r=u[1],u=[0];continue;case 7:u=o.ops.pop(),o.trys.pop();continue;default:if(!(e=o.trys,(e=e.length>0&&e[e.length-1])||6!==u[0]&&2!==u[0])){o=0;continue}if(3===u[0]&&(!e||u[1]>e[0]&&u[1]<e[3])){o.label=u[1];break}if(6===u[0]&&o.label<e[1]){o.label=e[1],e=u;break}if(e&&o.label<e[2]){o.label=e[2],o.ops.push(u);break}e[2]&&o.ops.pop(),o.trys.pop();continue}u=i.call(t,o)}catch(t){u=[6,t],r=0}finally{n=e=0}if(5&u[0])throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}([u,h])}}},y="zc.ra.1",b=function(n){function r(i,r,e){var s=n.call(this,i,e)||this;return s.i=i,s.audioTrack=null,s.zegoRTC=e.zegoRTC,s.userID=r.userID,s.teamID=r.teamID,s.raMode=void 0!==r.raMode?r.raMode:t.vy.World,r.position&&(s.position=r.position),s}return p(r,n),Object.defineProperty(r.prototype,"sendMode",{get:function(){return void 0!==this._sendMode?this._sendMode:this.raMode===t.vy.World?t.VO.All:t.VO.Team},set:function(t){this._sendMode=t},enumerable:!1,configurable:!0}),r.prototype.checkTrackChanged=function(){var t;if(this.stream){var i=this.stream.getAudioTracks()[0];i&&i!==this.audioTrack&&(this.i.info(y+" retry play success, render stream."),null===(t=this.sourceNode)||void 0===t||t.disconnect(),this.sourceNode=this.audioCtx.createMediaStreamSource(this.stream),this.changeRenderConfig(this.isSpatial,!0),this.audioTrack=i)}},r.prototype.startPlayingAudio=function(t){var n,r;return w(this,void 0,void 0,(function(){var s,o,u;return m(this,(function(h){switch(h.label){case 0:if(!this.streamID)return[2];h.label=1;case 1:return h.trys.push([1,3,,4]),t&&this.i.info(y+" ".concat(this.streamID," ")+t),this.isPlaying=!0,s=this,[4,this.zegoRTC.startPlayingStream(this.streamID)];case 2:return s.stream=h.sent(),this.audioTrack=this.stream.getAudioTracks()[0],[3,4];case 3:if(o=h.sent(),this.isPlaying=!1,1103049===o.code)return[2];throw o;case 4:return this.audioEl=this.audioEl||e.useAudioEl()||null,this.i.info(y+" ".concat(this.streamID," start using audio el ").concat(null===(n=this.audioEl)||void 0===n?void 0:n.id)),(u=null===(r=this.audioEl)||void 0===r?void 0:r.dom)||(this.i.error(y+" not enough audio elements"),u=i.Au.createElement("audio"),this.audioEl={id:-1,dom:u,used:!0},u.setAttribute("autoplay","autoplay")),u.muted=!0,this.stream&&(this.sourceNode=this.audioCtx.createMediaStreamSource(this.stream)),this.sourceNode?[4,this.changeRenderConfig(this.isSpatial,!0)]:[3,6];case 5:h.sent(),h.label=6;case 6:return"suspended"===this.audioCtx.state&&this.audioCtx.resume(),[2]}}))}))},r.prototype.stopPlayingAudio=function(t){this.isPlaying&&this.streamID?(this.i.info(y+" ".concat(this.streamID," ")+t),this.zegoRTC.stopPlayingStream(this.streamID),this.isPlaying=!1):this.streamID&&this.i.info(y+" ".concat(this.streamID," not playing, ")+t),this.stream=void 0,this.sourceNode&&(this.sourceNode.disconnect(),this.sourceNode=null);var i=this.audioEl,n=null==i?void 0:i.dom;n&&(n.srcObject=null,n.parentNode&&n.parentNode.removeChild(n));var r=(null==i?void 0:i.id)||-1;i&&r>=0&&(e.stopUsingAudioEl(r),this.i.info(y+" ".concat(this.streamID," stop using audio el ").concat(r))),this.audioEl=null,this.loopbackConn&&(this.loopbackConn.close(),this.loopbackConn.onError=null)},r.prototype.isSpeakInTeam=function(i){var n=![this.teamID,i].includes(void 0)&&""!==this.teamID&&this.teamID===i,r=[t.VO.Team,t.VO.All].includes(this.sendMode);return n&&r},r}(v),g=function(){var t=function(i,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,i){t.__proto__=i}||function(t,i){for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(t[n]=i[n])},t(i,n)};return function(i,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=i}t(i,n),i.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),E=function(t,i,n,r){return new(n||(n=Promise))((function(e,s){function o(t){try{h(r.next(t))}catch(t){s(t)}}function u(t){try{h(r.throw(t))}catch(t){s(t)}}function h(t){var i;t.done?e(t.value):(i=t.value,i instanceof n?i:new n((function(t){t(i)}))).then(o,u)}h((r=r.apply(t,i||[])).next())}))},k=function(t,i){var n,r,e,s,o={label:0,sent:function(){if(1&e[0])throw e[1];return e[1]},trys:[],ops:[]};return s={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function u(u){return function(h){return function(u){if(n)throw new TypeError("Generator is already executing.");for(;s&&(s=0,u[0]&&(o=0)),o;)try{if(n=1,r&&(e=2&u[0]?r.return:u[0]?r.throw||((e=r.return)&&e.call(r),0):r.next)&&!(e=e.call(r,u[1])).done)return e;switch(r=0,e&&(u=[2&u[0],e.value]),u[0]){case 0:case 1:e=u;break;case 4:return o.label++,{value:u[1],done:!1};case 5:o.label++,r=u[1],u=[0];continue;case 7:u=o.ops.pop(),o.trys.pop();continue;default:if(!(e=o.trys,(e=e.length>0&&e[e.length-1])||6!==u[0]&&2!==u[0])){o=0;continue}if(3===u[0]&&(!e||u[1]>e[0]&&u[1]<e[3])){o.label=u[1];break}if(6===u[0]&&o.label<e[1]){o.label=e[1],e=u;break}if(e&&o.label<e[2]){o.label=e[2],o.ops.push(u);break}e[2]&&o.ops.pop(),o.trys.pop();continue}u=i.call(t,o)}catch(t){u=[6,t],r=0}finally{n=e=0}if(5&u[0])throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}([u,h])}}},x="zc.ra.4",S=function(t){function n(i,n,r){var e=t.call(this,i,r)||this;return e.i=i,e.media=n.media,e.position=n.position||null,e.createSource(),e.userID="custom"+(new Date).getTime(),e.config={needLoopback:!1,useGain:!1,playOnAudioContext:!1,useWebAudio:!0},e}return g(n,t),n.prototype.createSource=function(){var t=this;if((0,i.tq)())return this.i.info("".concat((0,i.tq)()," ").concat(this.userID," not create src.")),void(this.changeRenderConfig=function(){return E(t,void 0,void 0,(function(){return k(this,(function(t){return[2]}))}))});this.media&&(this.i.info(x+" create el source."),this.sourceNode||(this.sourceNode=this.audioCtx.createMediaElementSource(this.media)),null!==this.distance&&this.distance<this.maxDistance&&this.startPlayingAudio("in range"))},n.prototype.startPlayingAudio=function(t){var n,r;return E(this,void 0,void 0,(function(){var s;return k(this,(function(o){switch(o.label){case 0:return this.isPlaying?(this.i.info(x+" ".concat(this.userID," is already playing")),[2]):(t&&this.i.info(x+" vocal ".concat(this.userID," play for ").concat(t)),this.isPlaying=!0,(0,i.tq)()?(this.media.muted=!1,[2]):(this.audioEl=this.audioEl||e.useAudioEl()||null,this.i.info(x+" ".concat(this.userID," start using audio el ").concat(null===(n=this.audioEl)||void 0===n?void 0:n.id)),(s=null===(r=this.audioEl)||void 0===r?void 0:r.dom)||(this.i.error(x+" ".concat(this.userID," not enough audio elements")),s=i.Au.createElement("audio"),this.audioEl={id:-1,dom:s,used:!0},s.setAttribute("autoplay","autoplay")),s.muted=!0,s.setAttribute("autoplay","autoplay"),s.setAttribute("id","zg-audio-source-"+this.userID),this.sourceNode?[4,this.changeRenderConfig(this.isSpatial,!0)]:[3,2]));case 1:o.sent(),o.label=2;case 2:return"suspended"===this.audioCtx.state&&this.audioCtx.resume(),[2]}}))}))},n.prototype.stopPlayingAudio=function(t){if(void 0===t&&(t=""),this.isPlaying&&(this.i.info(x+" vocal ".concat(this.userID," stop for ")+t),this.isPlaying=!1),(0,i.tq)())this.media.muted=!0;else{this.sourceNode&&this.sourceNode.disconnect();var n=this.audioEl,r=null==n?void 0:n.dom;r&&(r.srcObject=null,r.parentNode&&r.parentNode.removeChild(r));var s=(null==n?void 0:n.id)||-1;n&&s>=0&&(e.stopUsingAudioEl(s),this.i.info(x+" ".concat(this.userID," stop using audio el ").concat(s))),this.audioEl=null}},n.prototype.checkIfCanPlay=function(t){var i=this.distance=this.getDistanceFromListener(t);null===i||i>this.maxDistance||0===this.maxDistance?this.stopPlayingAudio("out of range. ".concat(i," > ").concat(this.maxDistance)):this.startPlayingAudio("in range")},n}(v),O=function(){var t=function(i,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,i){t.__proto__=i}||function(t,i){for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(t[n]=i[n])},t(i,n)};return function(i,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=i}t(i,n),i.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),A=function(t,i,n,r){return new(n||(n=Promise))((function(e,s){function o(t){try{h(r.next(t))}catch(t){s(t)}}function u(t){try{h(r.throw(t))}catch(t){s(t)}}function h(t){var i;t.done?e(t.value):(i=t.value,i instanceof n?i:new n((function(t){t(i)}))).then(o,u)}h((r=r.apply(t,i||[])).next())}))},N=function(t,i){var n,r,e,s,o={label:0,sent:function(){if(1&e[0])throw e[1];return e[1]},trys:[],ops:[]};return s={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function u(u){return function(h){return function(u){if(n)throw new TypeError("Generator is already executing.");for(;s&&(s=0,u[0]&&(o=0)),o;)try{if(n=1,r&&(e=2&u[0]?r.return:u[0]?r.throw||((e=r.return)&&e.call(r),0):r.next)&&!(e=e.call(r,u[1])).done)return e;switch(r=0,e&&(u=[2&u[0],e.value]),u[0]){case 0:case 1:e=u;break;case 4:return o.label++,{value:u[1],done:!1};case 5:o.label++,r=u[1],u=[0];continue;case 7:u=o.ops.pop(),o.trys.pop();continue;default:if(!(e=o.trys,(e=e.length>0&&e[e.length-1])||6!==u[0]&&2!==u[0])){o=0;continue}if(3===u[0]&&(!e||u[1]>e[0]&&u[1]<e[3])){o.label=u[1];break}if(6===u[0]&&o.label<e[1]){o.label=e[1],e=u;break}if(e&&o.label<e[2]){o.label=e[2],o.ops.push(u);break}e[2]&&o.ops.pop(),o.trys.pop();continue}u=i.call(t,o)}catch(t){u=[6,t],r=0}finally{n=e=0}if(5&u[0])throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}([u,h])}}},_="zc.ra.4",T=function(t){function n(i,n,r){var e=t.call(this,i,r)||this;return e.i=i,e.streamView=n.streamView,e.position=n.position||null,e.createSource(),e.userID="stream"+(new Date).getTime(),e.config={needLoopback:!1,useGain:!1,playOnAudioContext:!1,useWebAudio:!0},e.streamView.on("_trackChange",(function(t,i){"audio"===t&&(i?e.createSource(!0):e.i.error("".concat(_," ").concat(e.userID," audio track lost")))})),e}return O(n,t),n.prototype.createSource=function(t){var n=this;if(void 0===t&&(t=!1),(0,i.tq)())return this.i.info("".concat(_," ").concat(this.userID," not create src.")),this.changeRenderConfig=function(){return A(n,void 0,void 0,(function(){return N(this,(function(t){return[2]}))}))},!1;if(!this.streamView)return!1;if(this.i.info(_+" create view source. trackChanged: "+t),!this.sourceNode||t){var r=this.streamView.v.getAudioNodeAndStopRender();if(!r)return this.i.error(_+" create view source failed."),!1;this.sourceNode&&this.sourceNode.disconnect(),this.sourceNode=r,this.changeRenderConfig(this.isSpatial,!0)}return null!==this.distance&&this.distance<this.maxDistance&&this.startPlayingAudio("in range"),!0},n.prototype.startPlayingAudio=function(t){var n,r;return A(this,void 0,void 0,(function(){var s;return N(this,(function(o){switch(o.label){case 0:return this.isPlaying?(this.i.info(_+" ".concat(this.userID," is already playing")),[2]):(t&&this.i.info(_+" vocal ".concat(this.userID," play for ").concat(t)),this.isPlaying=!0,(0,i.tq)()?(this.streamView.setAudioMuted(!1),[2]):(this.audioEl=this.audioEl||e.useAudioEl()||null,this.i.info(_+" ".concat(this.userID," start using audio el ").concat(null===(n=this.audioEl)||void 0===n?void 0:n.id)),(s=null===(r=this.audioEl)||void 0===r?void 0:r.dom)||(this.i.error(_+" ".concat(this.userID," not enough audio elements")),s=i.Au.createElement("audio"),this.audioEl={id:-1,dom:s,used:!0},s.setAttribute("autoplay","autoplay")),s.muted=!0,s.setAttribute("autoplay","autoplay"),s.setAttribute("id","zg-audio-source-"+this.userID),this.sourceNode?[4,this.changeRenderConfig(this.isSpatial,!0)]:[3,2]));case 1:o.sent(),o.label=2;case 2:return"suspended"===this.audioCtx.state&&this.audioCtx.resume(),[2]}}))}))},n.prototype.stopPlayingAudio=function(t){if(void 0===t&&(t=""),this.isPlaying&&(this.i.info(_+" vocal ".concat(this.userID," stop for ")+t),this.isPlaying=!1),(0,i.tq)())this.streamView.setAudioMuted(!0);else{this.sourceNode&&this.sourceNode.disconnect();var n=this.audioEl,r=null==n?void 0:n.dom;r&&(r.srcObject=null,r.parentNode&&r.parentNode.removeChild(r));var s=(null==n?void 0:n.id)||-1;n&&s>=0&&(e.stopUsingAudioEl(s),this.i.info(_+" ".concat(this.userID," stop using audio el ").concat(s))),this.audioEl=null}},n.prototype.checkIfCanPlay=function(t){var i=this.distance=this.getDistanceFromListener(t);null===i||i>this.maxDistance||0===this.maxDistance?this.stopPlayingAudio("out of range. ".concat(i," > ").concat(this.maxDistance)):this.startPlayingAudio("in range")},n}(v),R=n(3189),C=function(){function t(){this.u={}}return t.getInstance=function(){return t.instance||(t.instance=new t),t.instance},t.prototype.addEventHandler=function(t,i){if(this.u[t]||(this.u[t]=[]),!(0,a.ae)(i))throw new Error("Params callBack is not a Function");return-1==this.u[t].indexOf(i)&&this.u[t].push(i),!0},t.prototype.removeEventHandler=function(t,i){return!!this.u[t]&&(this.u[t]=i?this.u[t].filter((function(t){return t!==i})):[],!0)},t.prototype.emit=function(t){for(var i=[],n=1;n<arguments.length;n++)i[n-1]=arguments[n];this.u[t]&&this.u[t].forEach((function(n){try{setTimeout((function(){n.apply(void 0,i)}),0)}catch(i){console.error('Fail to execute callback of event "'.concat(t,'" : ').concat(i))}}))},t.prototype.reset=function(){this.u={}},t}(),M=C,I=function(t,i,n,r){return new(n||(n=Promise))((function(e,s){function o(t){try{h(r.next(t))}catch(t){s(t)}}function u(t){try{h(r.throw(t))}catch(t){s(t)}}function h(t){var i;t.done?e(t.value):(i=t.value,i instanceof n?i:new n((function(t){t(i)}))).then(o,u)}h((r=r.apply(t,i||[])).next())}))},P=function(t,i){var n,r,e,s,o={label:0,sent:function(){if(1&e[0])throw e[1];return e[1]},trys:[],ops:[]};return s={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function u(u){return function(h){return function(u){if(n)throw new TypeError("Generator is already executing.");for(;s&&(s=0,u[0]&&(o=0)),o;)try{if(n=1,r&&(e=2&u[0]?r.return:u[0]?r.throw||((e=r.return)&&e.call(r),0):r.next)&&!(e=e.call(r,u[1])).done)return e;switch(r=0,e&&(u=[2&u[0],e.value]),u[0]){case 0:case 1:e=u;break;case 4:return o.label++,{value:u[1],done:!1};case 5:o.label++,r=u[1],u=[0];continue;case 7:u=o.ops.pop(),o.trys.pop();continue;default:if(!(e=o.trys,(e=e.length>0&&e[e.length-1])||6!==u[0]&&2!==u[0])){o=0;continue}if(3===u[0]&&(!e||u[1]>e[0]&&u[1]<e[3])){o.label=u[1];break}if(6===u[0]&&o.label<e[1]){o.label=e[1],e=u;break}if(e&&o.label<e[2]){o.label=e[2],o.ops.push(u);break}e[2]&&o.ops.pop(),o.trys.pop();continue}u=i.call(t,o)}catch(t){u=[6,t],r=0}finally{n=e=0}if(5&u[0])throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}([u,h])}}};var D,L=function(){function i(i,n){var r=this;this.raMode=t.vy.World,this.recvRange=null,this.position=null,this.forwardAxis=[1,0,0],this.upAxis=[0,0,1],this.audioStream=null,this.enableMic=!1,this.isPublishing=!1,this.streamID=null,this.isDenoise=!1,this.denoiseMode=R.ZD.AI,this.voiceChanger=null,this.voiceParam=null,this.isUpdated=!0,this.zegoRTC=n,this.audioCtx=i,this.audioListener=this.audioCtx.listener,this.eventHandler=M.getInstance(),this.zegoRTC.on("publisherStateUpdate",(function(i){var n=i.state,e=i.errorCode,s=i.extendedData,o=i.streamID.match(/(.*)_(.*)/);if(3===(null==o?void 0:o.length)){if(r.userID!==o[1])return;"NO_PUBLISH"===n?(r.isPublishing=!1,r.stopPublishingStream()):(r.isPublishing=!0,r.isUpdated||(r.i.info(y+" resend stream info"),r.updateSteamExtraInfo())),r.eventHandler.emit("microphoneStateUpdate",{NO_PUBLISH:t.tp.Off,PUBLISH_REQUESTING:t.tp.TurningOn,PUBLISHING:t.tp.On}[n],e,s)}})),this.zegoRTC.on("deviceError",(function(t,i){return I(r,void 0,void 0,(function(){var n,r;return P(this,(function(e){switch(e.label){case 0:return this.i.info(y+" device fail ".concat(t," ").concat(i," ").concat(!!this.audioStream," ").concat(this.micID)),this.audioStream?[4,this.zegoRTC.enumDevices()]:[2];case 1:return n=e.sent(),r=n.microphones,this.micID||0!==r.length?1106009!==t?[3,3]:[4,this.zegoRTC.useAudioDevice(this.audioStream,this.micID||r[0].deviceID)]:[2];case 2:e.sent(),e.label=3;case 3:return[2]}}))}))}))}return Object.defineProperty(i.prototype,"recvMode",{get:function(){return void 0!==this._recvMode?this._recvMode:[t.vy.World,t.vy.SecretTeam].includes(this.raMode)?t.BI.All:t.BI.Team},set:function(t){this._recvMode=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"sendMode",{get:function(){return void 0!==this._sendMode?this._sendMode:this.raMode===t.vy.World?t.VO.All:t.VO.Team},set:function(t){this._sendMode=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"i",{get:function(){return this.zegoRTC.logger},enumerable:!1,configurable:!0}),i.getInstance=function(t,n){return i.instance||(i.instance=new i(t,n)),i.instance},i.prototype.updateSelfPosition=function(t,i,n){this.position=t,this.forwardAxis=i,Array.isArray(n)&&(this.upAxis=n),this.updateListenerEffect()},i.prototype.updateListenerEffect=function(){this.position&&(this.audioListener.positionX?(this.audioListener.positionX.value=this.position[1],this.audioListener.positionY.value=this.position[2],this.audioListener.positionZ.value=-this.position[0]):this.audioListener.setPosition(this.position[1],this.position[2],-this.position[0]),this.audioListener.forwardX?(this.audioListener.forwardX.value=this.forwardAxis[1],this.audioListener.forwardY.value=this.forwardAxis[2],this.audioListener.forwardZ.value=-this.forwardAxis[0],this.audioListener.upX.value=this.upAxis[1],this.audioListener.upY.value=this.upAxis[2],this.audioListener.upZ.value=-this.upAxis[0]):this.audioListener.setOrientation(this.forwardAxis[1],this.forwardAxis[2],-this.forwardAxis[0],this.upAxis[1],this.upAxis[2],-this.upAxis[0]))},i.prototype.startPublishingStream=function(){var t=this;this.enableMic?this.i.warn(y+" mic is already enabled"):(this.enableMic=!0,this.zegoRTC.createStream({camera:{video:!1,audio:!0,audioInput:this.micID||void 0,audioBitrate:30}}).then((function(i){return I(t,void 0,void 0,(function(){return P(this,(function(t){if(!this.userID)throw this.zegoRTC.destroyStream(i),this.enableMic=!1,Error("Enable mic failed. Please log in room first.");return this.audioStream&&this.audioStream!==i&&this.zegoRTC.destroyStream(this.audioStream),this.audioStream=i,this.isDenoise&&(this.enableDenoise(this.isDenoise),this.denoiseMode===R.ZD.AIBalanced&&this.setAiDenoiseMode(this.denoiseMode)),null!==this.voiceChanger&&this.setVoiceChangerPreset({voiceChanger:this.voiceChanger}),null!==this.voiceParam&&this.setVoiceChangerPreset({voiceParam:this.voiceParam}),this.streamID=this.userID+"_"+Date.now(),this.zegoRTC.startPublishingStream(this.streamID,i,{extraInfo:JSON.stringify(this.getExtraInfo())}),[2]}))}))})).catch((function(i){throw t.audioStream=null,t.enableMic=!1,i})))},i.prototype.stopPublishingStream=function(){this.isPublishing&&this.streamID&&this.zegoRTC.stopPublishingStream(this.streamID),this.isPublishing=!1,this.audioStream&&(this.zegoRTC.destroyStream(this.audioStream),this.audioStream=null),this.enableMic=!1},i.prototype.setCustomMode=function(t,i){var n=!1,r=!1,e=!1;return i!==this.recvMode&&(this.recvMode=i,e=!0),t!==this.sendMode&&(this.sendMode=t,n=!0,r=!0),n&&this.updateSteamExtraInfo(),{sendChange:r,recvChange:e}},i.prototype.setNormalMode=function(t){this.raMode=t,this.updateSteamExtraInfo()},i.prototype.setTeamID=function(t){this.teamID=t,this.updateSteamExtraInfo()},i.prototype.updateSteamExtraInfo=function(){var t=this;this.streamID&&this.isPublishing&&(this.isUpdated=!1,this.i.info(y+" update stream info"),this.zegoRTC.setStreamExtraInfo(this.streamID,JSON.stringify(this.getExtraInfo())).then((function(i){0===i.errorCode&&(t.i.info(y+" update stream info success"),t.isUpdated=!0)})))},i.prototype.getExtraInfo=function(){var i,n={range_audio_team_id:this.teamID||"",range_audio_mode:(i=this.raMode,{0:1,1:2,2:3}[i]),r_a_s_flag:1};return void 0===this._sendMode&&this.raMode!==t.vy.World||(n.r_a_speak=this.sendMode),n},i.prototype.reset=function(){this.audioStream&&this.stopPublishingStream(),this.userID=void 0,this.streamID=null},i.prototype.enableDenoise=function(t){var i=this;return this.audioStream&&this.zegoRTC._enableAiDenoise(this.audioStream,t).catch((function(t){i.isDenoise=!1;var n=t||{};i.eventHandler.emit("aiDenoiseError",n.errorCode,n.extendedData)})),this.isDenoise=t,!0},i.prototype.setAiDenoiseMode=function(t){var i=this;return this.audioStream&&this.zegoRTC.setAiDenoiseMode(this.audioStream,t).catch((function(t){i.denoiseMode=R.ZD.AI;var n=t||{};i.eventHandler.emit("aiDenoiseError",n.errorCode,n.extendedData)})),this.denoiseMode=t,!0},i.prototype.setVoiceChangerPreset=function(t){var i=this;return this.audioStream&&this.zegoRTC.setVoiceChangerPreset(this.audioStream,t).catch((function(t){i.voiceChanger=null;var n=t||{};i.eventHandler.emit("voiceChangerError",n.errorCode,n.extendedData)})),"voiceChanger"in t&&void 0!==t.voiceChanger?(this.voiceChanger=t.voiceChanger,this.voiceParam=null):"voiceParam"in t&&void 0!==t.voiceParam&&(this.voiceParam=t.voiceParam,this.voiceChanger=null),!0},i}(),j=function(t,i,n){if(n||2===arguments.length)for(var r,e=0,s=i.length;e<s;e++)!r&&e in i||(r||(r=Array.prototype.slice.call(i,0,e)),r[e]=i[e]);return t.concat(r||Array.prototype.slice.call(i))},U="zc.ra.2",F=function(){function i(t,i){this.i=t,this.isEnable=!1,this.interval=100,this.timer=null,this.audioSourceList=[],this.hasChanged=!1,this.userChanged=!1,this.updateUserInterval=1e3,this.updateUserTimer=null,this.audioSourceUpdate=!1,this._maxPlayingQuantity=20,this.allAudioSourceList=[],this.audioSourceWithinRangeList=[],this.localUserList=[],this.h=i}return i.getInstance=function(t,n){return i.instance||(i.instance=new i(t,n)),i.instance},i.prototype.setAudioSourceUpdate=function(t){this.audioSourceUpdate=t},i.prototype.setListener=function(t){this.h=t,this.hasChanged=!0,this.userChanged=!0},i.prototype.setAudioSourceList=function(t){this.audioSourceList=t,this.i.info("".concat(U," set src list: [").concat(t.map((function(t){return t.userID})).join(","),"]")),this.hasChanged=!0},i.prototype.setAllAudioSourceList=function(t){t&&(this.allAudioSourceList=t),this.userChanged=!0},i.prototype.startPlayingAudioStream=function(){this.timer&&(clearTimeout(this.timer),this.timer=null),this.hasChanged=!0,this.playAudioTask()},i.prototype.playAudioTask=function(){var t=this;this.hasChanged&&(this.hasChanged=!1,this.handlePlayAudioTask()),this.timer=window.setTimeout((function(){t.playAudioTask()}),this.interval)},i.prototype.handlePlayAudioTask=function(){var i=this;if(this.isEnable){this.i.info("".concat(U," handler task start"));var n=j([],this.audioSourceList,!0),r=0,e=this.h.recvMode;if([t.BI.Team,t.BI.All].includes(e)){var s=this.getTeamAudioSourceGroup();n=s.otherList,s.teamList.forEach((function(t){r<i._maxPlayingQuantity&&(t.isPlaying||t.startPlayingAudio("play for team"),r++)}))}var o=[t.BI.World,t.BI.All].includes(e);o&&(n.forEach((function(t){t.distance=t.getDistanceFromListener(i.h)})),n.sort((function(t,i){return null===t.distance?1:null===i.distance||t.distance<i.distance?-1:t.distance>i.distance?1:0}))),n.forEach((function(n){var e=[t.VO.All,t.VO.World].includes(n.sendMode)&&null!==n.distance&&(null===i.h.recvRange||n.distance<=i.h.recvRange);if(o&&r<i._maxPlayingQuantity&&e)n.isPlaying||n.startPlayingAudio("play for range"),r++;else{var s="stop for mode or range. mode: ".concat(n.sendMode,", range: ").concat(n.distance," > ").concat(i.h.recvRange);n.stopPlayingAudio(s)}})),this.i.info(U+" playing quantity: ".concat(r,"."))}else this.stopPlayingAudioStream()},i.prototype.startCheckUserInRange=function(){this.i.info(U+" start user check"),this.updateUserTimer&&(clearTimeout(this.updateUserTimer),this.updateUserTimer=null),this.userChanged=!0,this.userCheckTask()},i.prototype.stopCheckUserInRange=function(){this.i.info(U+" stop user check"),this.updateUserTimer&&(clearTimeout(this.updateUserTimer),this.updateUserTimer=null)},i.prototype.userCheckTask=function(){var t=this;this.userChanged&&(this.userChanged=!1,this.handleUserCheckTask()),this.updateUserTimer=window.setTimeout((function(){t.userCheckTask()}),this.updateUserInterval)},i.prototype.handleUserCheckTask=function(){var t=this;if(this.audioSourceUpdate){var i=[];this.allAudioSourceList.forEach((function(n){n.distance=n.getDistanceFromListener(t.h);var r=null!==n.distance&&(null===t.h.recvRange||n.distance<=t.h.recvRange),e=!!t.localUserList.find((function(t){return t.userID===n.userID}));r&&e&&i.push({userID:n.userID,position:n.position})})),this.checkAudioSourceListDiff(i,this.audioSourceWithinRangeList)&&this.h.eventHandler.emit("audioSourceWithinRangeUpdate",i),this.audioSourceWithinRangeList=i}},i.prototype.getTeamAudioSourceGroup=function(){var t=this,i=[],n=[];return this.audioSourceList.forEach((function(r){r.isSpeakInTeam(t.h.teamID)?i.push(r):n.push(r)})),{teamList:i,otherList:n}},i.prototype.stopPlayingAudioStream=function(){this.timer&&(clearTimeout(this.timer),this.timer=null);this.audioSourceList.forEach((function(t){t.stopPlayingAudio("stop for all stream")}))},i.prototype.setLocalUserList=function(t){this.localUserList=t,this.userChanged=!0},i.prototype.checkAudioSourceListDiff=function(t,i){for(var n,r=0;r<t.length;r++){n=!1;for(var e=0;e<i.length;e++)if(t[r].userID===i[e].userID){n=!0;break}if(!n)return!0}for(var s=0;s<i.length;s++){n=!1;for(var o=0;o<t.length;o++)if(i[s].userID===t[o].userID){n=!0;break}if(!n)return!0}return!1},i}();function G(t){return!isNaN(Number(t))&&""!==t&&Number.MAX_SAFE_INTEGER>=Number(t)&&Number(t)>=-Number.MAX_SAFE_INTEGER}function H(t){if(Array.isArray(t)){for(var i=0;i<3;i++){if(!G(t[i]))return!1}return!0}return!1}!function(t){t[t.Normal=0]="Normal",t[t.Custom=1]="Custom"}(D||(D={}));var z=function(){return z=Object.assign||function(t){for(var i,n=1,r=arguments.length;n<r;n++)for(var e in i=arguments[n])Object.prototype.hasOwnProperty.call(i,e)&&(t[e]=i[e]);return t},z.apply(this,arguments)},V=function(t,i,n,r){return new(n||(n=Promise))((function(e,s){function o(t){try{h(r.next(t))}catch(t){s(t)}}function u(t){try{h(r.throw(t))}catch(t){s(t)}}function h(t){var i;t.done?e(t.value):(i=t.value,i instanceof n?i:new n((function(t){t(i)}))).then(o,u)}h((r=r.apply(t,i||[])).next())}))},W=function(t,i){var n,r,e,s,o={label:0,sent:function(){if(1&e[0])throw e[1];return e[1]},trys:[],ops:[]};return s={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function u(u){return function(h){return function(u){if(n)throw new TypeError("Generator is already executing.");for(;s&&(s=0,u[0]&&(o=0)),o;)try{if(n=1,r&&(e=2&u[0]?r.return:u[0]?r.throw||((e=r.return)&&e.call(r),0):r.next)&&!(e=e.call(r,u[1])).done)return e;switch(r=0,e&&(u=[2&u[0],e.value]),u[0]){case 0:case 1:e=u;break;case 4:return o.label++,{value:u[1],done:!1};case 5:o.label++,r=u[1],u=[0];continue;case 7:u=o.ops.pop(),o.trys.pop();continue;default:if(!(e=o.trys,(e=e.length>0&&e[e.length-1])||6!==u[0]&&2!==u[0])){o=0;continue}if(3===u[0]&&(!e||u[1]>e[0]&&u[1]<e[3])){o.label=u[1];break}if(6===u[0]&&o.label<e[1]){o.label=e[1],e=u;break}if(e&&o.label<e[2]){o.label=e[2],o.ops.push(u);break}e[2]&&o.ops.pop(),o.trys.pop();continue}u=i.call(t,o)}catch(t){u=[6,t],r=0}finally{n=e=0}if(5&u[0])throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}([u,h])}}},J=function(t,i,n){if(n||2===arguments.length)for(var r,e=0,s=i.length;e<s;e++)!r&&e in i||(r||(r=Array.prototype.slice.call(i,0,e)),r[e]=i[e]);return t.concat(r||Array.prototype.slice.call(i))};function q(){var t;return V(this,void 0,void 0,(function(){var i,n,r;return W(this,(function(e){switch(e.label){case 0:return(i=null===navigator||void 0===navigator?void 0:navigator.userAgentData)?[4,i.getHighEntropyValues(["platformVersion"]).catch((function(){}))]:[2,{platform:"",majorPlatformVersion:0}];case 1:return n=e.sent()||{},r=parseInt(null===(t=n.platformVersion)||void 0===t?void 0:t.split(".")[0]),[2,{platform:n.platform,majorPlatformVersion:r}]}}))}))}var B="zc.ra.0";var Q=function(){function n(t,n){var r=this;this.i=n,this.isSpatial=!1,this.audioSourceList=[],this.audioSourceUpdate=!1,this.localUserList=[],this.speakingUserIdList=[],this.vocalSourceMap=new Map,this.volume=1,this.speaker="",this.l=null,this.supportSpeakerSet=!1,this.isHide=!1,this.eventHandler={visibilitychange:function(){return V(r,void 0,void 0,(function(){var t,n,r,e,s,o=this;return W(this,(function(u){switch(u.label){case 0:return J(J([],this.vocalSourceList,!0),this.audioSourceList,!0).forEach((function(t){t.inBackground(i.Au.hidden),o.isHide=i.Au.hidden})),t=function(){J(J([],o.vocalSourceList,!0),o.audioSourceList,!0).forEach((function(t){t.changeRenderConfig(o.isOpen3D(t),!0,!1,!1)}))},i.Au.hidden?(n=(0,i.i7)()&&(0,i.tq)(),[4,q()]):[3,2];case 1:return r=u.sent(),e="Windows"===r.platform&&r.majorPlatformVersion>=13,n||e?(this.i.warn("".concat(B," mobile chrome hide page and stop web audio.")),t(),[2]):("running"!==(s=this.audioCtx.state)?(this.i.info("".concat(B," hidden ctx: ").concat(s,", resume ctx")),this.audioCtx.resume(),setTimeout((function(){var i=o.audioCtx.state;o.isHide&&("running"===i?o.i.info("".concat(B," hidden ctx: ").concat(i,".")):(o.i.warn("".concat(B," hidden ctx: ").concat(i,", ctx resume failed. stop web audio.")),t()))}),2e3)):this.i.info("".concat(B," hidden ctx: ").concat(s,".")),[3,3]);case 2:this.audioCtx.resume(),this.audioSourceList.forEach((function(t){var i,n;t.isPlaying&&(null===(i=t.audioEl)||void 0===i||i.dom.pause(),null===(n=t.audioEl)||void 0===n||n.dom.play().catch((function(){o.i.warn("".concat(B," show page and  ").concat(t.userID," replay failed."))})))})),u.label=3;case 3:return[2]}}))}))}},this.zegoRTC=t,i.Au.addEventListener("visibilitychange",this.eventHandler.visibilitychange,!1),this.zegoRTC.on("roomStreamUpdate",(function(t,i,n){var e=n.map((function(t){var i=r.getStreamInfo(t.extraInfo,t.streamID),n=i.isRangeAudioStream,e=i.teamID,s=i.raMode,o=i.sendMode;return z(z({},t),{isRangeAudioStream:n,teamID:e,raMode:s,sendMode:o})})).filter((function(t){return t.isRangeAudioStream})),s=e.map((function(t){return t.user.userID}));"DELETE"===i?r.speakingUserIdList=r.speakingUserIdList.filter((function(t){var i=!s.includes(t);if(!i){var n=r.audioSourceMap[t];if(n){n.stopPlayingAudio("stop for stream delete")}}return i})):"ADD"===i&&(r.speakingUserIdList=r.speakingUserIdList.concat(s),e.forEach((function(t){var i=t.user.userID,n=r.audioSourceMap[i],e=t.teamID,s=t.raMode,o=t.sendMode;if(n)n.streamID!==t.streamID&&(n.stopPlayingAudio("stop for old stream"),n.streamID=t.streamID),void 0!==s&&(n.raMode=s),e!==n.teamID&&(n.teamID=e),n.changeRenderConfig(r.isOpen3D(n));else{var u=new b(r.i,{userID:i,teamID:e,raMode:s,sendMode:o},{audioCtx:r.audioCtx,zegoRTC:r.zegoRTC,isSpatial:r.isSpatial,maxDistance:r.h.recvRange,volume:r.volume,speaker:r.speaker,isHide:r.isHide});u.streamID=t.streamID,r.audioSourceList.push(u),r.playStreamHandler.hasChanged=!0}}))),r.playStreamHandler.setAudioSourceList(r.speakingAudioSourceList)})),this.zegoRTC.on("playerStateUpdate",(function(t){var i=r.audioSourceList.find((function(i){return i.streamID===t.streamID}));i&&("NO_PLAY"===t.state?i.isPlaying=!1:("PLAYING"===t.state&&i.checkTrackChanged(),i.isPlaying=!0))})),this.zegoRTC.on("streamExtraInfoUpdate",(function(t,i){r.i.info(B+" recv extra info: "+JSON.stringify(i));var n=!1;i.forEach((function(t){var i=r.audioSourceMap[t.user.userID];if(i&&i.streamID){var e=r.getStreamInfo(t.extraInfo,t.streamID),s=e.teamID,o=e.raMode,u=e.sendMode;s!==i.teamID&&(i.teamID=s,n=!0),void 0!==o&&(i.raMode=o,n=!0),i.sendMode!==u&&(i.sendMode=u,n=!0),r.playStreamHandler.hasChanged=!0}})),n&&r.enableSpatializer(r.isSpatial)})),this.zegoRTC.RTM._on("_roomStateUpdate",(function(t,i){"CONNECTED"===i?(r.roomID=t,r.h.userID=r.zegoRTC.RTM.getUserID(),r.playStreamHandler.hasChanged=!0,r.playStreamHandler.userChanged=!0):"DISCONNECTED"===i&&(r.roomID=void 0,r.h.reset(),r.enableSpeaker(!1),r.audioSourceList=[],r.playStreamHandler.setAudioSourceList([]),r.localUserList=[],r.playStreamHandler.setLocalUserList([]))})),this.zegoRTC.RTM.on("roomUserUpdate",(function(t,i,n){var e;r.i.info(B+" roomUserUpdate: ",t,i,JSON.stringify(n)),"ADD"===i?(e=r.localUserList).push.apply(e,n):"DELETE"===i&&n.forEach((function(t){r.localUserList=r.localUserList.filter((function(i){return i.userID!==t.userID}))})),r.playStreamHandler.setLocalUserList(r.localUserList)})),this.zegoRTC.on("publishQualityUpdate",(function(t,i){var n=t.match(/(.*)_(.*)/);if(3===(null==n?void 0:n.length)){var e=n[1];if(r.h.userID!==e)return;var s=z({},i.audio);r.eventManager.emit("publishQualityUpdate",e,s)}})),this.zegoRTC.on("playQualityUpdate",(function(t,i){var n,e=t.match(/(.*)_(.*)/);if(3===(null==e?void 0:e.length)){var s=e[1],o=i.audio,u=i.peerToPeerDelay,h=i.peerToPeerPacketLostRate;if(!(null===(n=r.audioSourceList)||void 0===n?void 0:n.some((function(t){return t.userID===s}))))return;var a=z(z({},o),{peerToPeerDelay:u,peerToPeerPacketLostRate:h});r.eventManager.emit("playQualityUpdate",s,a)}})),this.l=this.p(),this.h=L.getInstance(this.audioCtx,this.zegoRTC),this.playStreamHandler=F.getInstance(this.i,this.h),this.eventManager=M.getInstance()}return Object.defineProperty(n.prototype,"audioSourceMap",{get:function(){return this.audioSourceList.reduce((function(t,i){return i.userID&&(t[i.userID]=i),t}),{})},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"speakingAudioSourceList",{get:function(){var t=this;return this.audioSourceList.filter((function(i){return t.speakingUserIdList.includes(i.userID)}))},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"vocalSourceList",{get:function(){for(var t=[],i=this.vocalSourceMap.values(),n=0;n<this.vocalSourceMap.size;n++)t.push(i.next().value);return t},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"playingAudioSourceList",{get:function(){return this.audioSourceList.filter((function(t){return t.isPlaying}))},enumerable:!1,configurable:!0}),n.prototype.p=function(){var t=this,i=new(window.AudioContext||window.webkitAudioContext);return i.addEventListener("statechange",(function(){"suspended"===i.state&&(t.i.info(B+" audio context suspended"),i.resume())})),i},Object.defineProperty(n.prototype,"audioCtx",{get:function(){return this.l||(this.l=this.p()),this.l},enumerable:!1,configurable:!0}),n.getInstance=function(t,i){return n.instance||(n.instance=new n(t,i)),n.instance},n.prototype.resumeAudioContext=function(){return V(this,void 0,void 0,(function(){var t=this;return W(this,(function(n){return[2,new i.GJ((function(i){e.generateEls(),"running"===t.audioCtx.state&&i(!0),t.audioCtx.onstatechange=function(){"running"===t.audioCtx.state&&i(!0)},t.audioCtx.resume(),t.i.info(B+" resume audio ctx"),setTimeout((function(){i(!1)}),3e3)}))]}))}))},n.prototype.getAudioContextState=function(){return this.audioCtx.state},n.prototype.getStreamInfo=function(t,i){var n=void 0,r=null;try{r=JSON.parse(t)}catch(t){return this.i.warn(B+" parse room extra info failed. ".concat(i," is not ra stream.")),{isRangeAudioStream:!1}}if(!r.hasOwnProperty("range_audio_team_id")||!r.hasOwnProperty("range_audio_mode"))return this.i.warn(B+" extra info has no mode. ".concat(i," is not ra stream.")),{isRangeAudioStream:!1};n={1:0,2:1,3:2}[r.range_audio_mode];var e=r.r_a_s_flag,s={teamID:r.range_audio_team_id||void 0,raMode:n,isRangeAudioStream:void 0===e||1===e};return r.hasOwnProperty("r_a_speak")&&(s.sendMode=r.r_a_speak),this.i.info("".concat(B," ").concat(i," parse extra info: ").concat(JSON.stringify(s),".")),s},n.prototype.setAudioReceiveRange=function(t){if(!G(t))throw Error("Failed to execute 'setAudioReceiveRange': Argument 'range' requires to be type number.");if(t=Number(t),(t=Number(t))<0)throw Error("Failed to execute 'setAudioReceiveRange': Argument 'range' can not be less than 0.");this.i.info(B+" set receive range: "+t),this.h.recvRange=t,this.audioSourceList.forEach((function(i){i.setMaxDistance(t)})),this.playStreamHandler.hasChanged=!0,this.playStreamHandler.userChanged=!0},n.prototype.updateSelfPosition=function(t,i,n,r){var e=this,s=function(t){return"Failed to execute 'updateSelfPosition': Argument '".concat(t,"' requires an array of type number.\"")};if(!H(t))throw new Error(s("position"));if(!H(i))throw new Error(s("axisForward"));if(!H(n))throw new Error(s("axisRight"));if(!H(r))throw new Error(s("axisUp"));this.i.info(B+" set self position [".concat(t,"]")),this.h&&(this.h.updateSelfPosition(t,i,r),this.vocalSourceMap.forEach((function(t){t.checkIfCanPlay(e.h)}))),this.playStreamHandler.setListener(this.h)},n.prototype.updateAudioSource=function(t,i){if(t=String(t),!H(i))throw new Error("Failed to execute 'updateAudioSource': parameter 'position' must be an array of type number.");var n=this.audioSourceMap[t];n?n.setPosition(i):(n=new b(this.i,{userID:t,position:i},{audioCtx:this.audioCtx,zegoRTC:this.zegoRTC,isSpatial:this.isSpatial,maxDistance:this.h.recvRange,volume:this.volume,speaker:this.speaker,isHide:this.isHide}),this.enableSpatializer(this.isSpatial),this.audioSourceList.push(n)),this.playStreamHandler.setAudioSourceList(this.speakingAudioSourceList),this.playStreamHandler.setAllAudioSourceList(this.audioSourceList)},n.prototype.enableMicrophone=function(t){if(void 0===t&&(t=!0),!this.h.userID)throw new Error("Enable mic failed. Please log in room first.");return t?this.h.startPublishingStream():this.h.stopPublishingStream()},n.prototype.selectMic=function(t){return V(this,void 0,void 0,(function(){var i,n,r,e;return W(this,(function(s){switch(s.label){case 0:if(!(0,a.Rk)(t)&&!(0,a.Qo)(t))throw new Error("Select mic failed. DeviceID error.");if(n=(i=this.h).audioStream,r=i.isPublishing,this.i.info(B+" select mic: "+t),!n||!r)return[3,5];e={errorCode:0},s.label=1;case 1:return s.trys.push([1,3,,4]),[4,this.zegoRTC.useAudioDevice(n,t||"")];case 2:return e=s.sent(),[3,4];case 3:return s.sent(),[2,!1];case 4:return 0===e.errorCode?(this.h.micID=t,[2,!0]):[2,!1];case 5:return this.h.micID=t,[2,!0];case 6:return[2]}}))}))},n.prototype.enableSpeaker=function(t){if(void 0===t&&(t=!0),t&&!this.roomID)throw new Error("Enable speaker failed. Please log in room first.");this.playStreamHandler.isEnable=t,this.i.info(B+" enable speaker: "+t),t?(e.generateEls(),this.playStreamHandler.startPlayingAudioStream()):this.playStreamHandler.stopPlayingAudioStream()},n.prototype.enableSpatializer=function(t){var i=this;void 0===t&&(t=!0),this.i.info(B+" set spatializer: "+t),this.isSpatial=!!t,this.audioSourceList.forEach((function(t){t.changeRenderConfig(i.isOpen3D(t))})),this.vocalSourceList.forEach((function(i){i.changeRenderConfig(t)})),t&&this.h.updateListenerEffect()},n.prototype.enableAiDenoise=function(t){if(this.i.info(B+" set ai denoise: "+t),!(0,a.ZV)(t))return!1;var n=(0,i.tq)();return(n||window.AudioWorklet)&&window.WebAssembly&&(window.AudioContext||(null===window||void 0===window?void 0:window.webkitAudioContext)).prototype.createScriptProcessor?this.h.enableDenoise(!!t):(this.i.error(B+"".concat(n&&" mobile"," browser dose not support ai denoise.")),!1)},n.prototype.setAiDenoiseMode=function(t){return void 0===t&&(t=R.ZD.AI),this.h.setAiDenoiseMode(t)},n.prototype.setVoiceChangerPreset=function(t){this.i.info(B+" set voice changer preset: "+JSON.stringify(t));var n=(0,i.tq)();return(n||window.AudioWorklet)&&window.WebAssembly&&(window.AudioContext||(null===window||void 0===window?void 0:window.webkitAudioContext)).prototype.createScriptProcessor?this.h.setVoiceChangerPreset(t):(this.i.error(B+"".concat(n&&" mobile"," browser dose not support voice changer.")),!1)},n.prototype.setRangeAudioTeamID=function(t){this.i.info(B+" set team id: "+t),this.h.setTeamID(t),this.enableSpatializer(this.isSpatial),this.playStreamHandler.hasChanged=!0},n.prototype.setRangeAudioMode=function(t){if(this.modeType===D.Custom)throw new Error("Failed to execute 'setRangeAudioMode': already use 'setRangeAudioCustomMode'.");this.modeType=D.Normal,this.i.info(B+" set mode "+t),this.h.setNormalMode(t),this.playStreamHandler.hasChanged=!0},n.prototype.setCustomMode=function(t,i){if(this.modeType===D.Normal)throw new Error("Failed to execute 'setRangeAudioCustomMode': already use 'setRangeAudioMode'.");this.modeType=D.Custom,this.i.info(B+" set custom mode: ".concat(t,", ").concat(i));var n=this.h.setCustomMode(t,i).recvChange;this.playStreamHandler.hasChanged=!0,n&&this.enableSpatializer(this.isSpatial)},n.prototype.setAudioVolume=function(t){var i=this;if(this.i.info(B+" set volume ".concat(t)),t<0)throw new Error("Failed to execute 'setVolume': The volume provided is outside the range [0, 200].");this.volume=t/100,this.audioSourceList.forEach((function(t){t.setVolume(i.volume)}))},n.prototype.selectSpeaker=function(t){var n=this;if(void 0===t&&(t=""),!(0,a.Rk)(t))throw new Error("Select speaker failed. Device ID error.");if(!this.supportSpeakerSet){if(!!!i.Au.createElement("audio").setSinkId)throw new Error("Failed to execute 'selectSpeaker': browser not support.");this.supportSpeakerSet=!0}this.speaker=t,this.i.info(B+" set speaker: "+t),""===t&&this.i.warn(B+" set speaker to be default. ");this.audioSourceList.find((function(i){return V(n,void 0,void 0,(function(){var n;return W(this,(function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),[4,i.setSpeaker(t)];case 1:return r.sent(),[3,3];case 2:return n=r.sent(),this.i.warn(B+" set speaker failed. id: ".concat(t,", error: ").concat(n)),[2,!0];case 3:return[2,!1]}}))}))}))},n.prototype.setPositionUpdateFrequency=function(t){if(!(t>=15))throw new Error("Failed to execute 'setPositionUpdateFrequency': The frequency provided is outside the range [15, +].");this.playStreamHandler.interval=Number(t)||100,this.i.info(B+" set interval: "+t)},n.prototype.on=function(t,i){return this.eventManager.addEventHandler(t,i)},n.prototype.off=function(t,i){return this.eventManager.removeEventHandler(t,i)},n.prototype.enableAudioSourceUpdateChecker=function(t,i){if(this.i.info(B+" set source update: "+t),this.audioSourceUpdate=t,this.playStreamHandler.setAudioSourceUpdate(t),i&&(0,a.UH)(i.frequency)){if(i.frequency<50)throw new Error("Failed to execute 'enableAudioSourceUpdateChecker': The frequency provided is outside the range [50, +].");this.playStreamHandler.updateUserInterval=Number(i.frequency)||1e3,this.i.info(B+" set interval: "+i.frequency)}t?this.playStreamHandler.startCheckUserInRange():this.playStreamHandler.stopCheckUserInRange()},n.prototype.getVocalSource=function(t,i){var n=this.vocalSourceMap.get(t);if(!n){var r={audioCtx:this.audioCtx,isSpatial:this.isSpatial,maxDistance:i||0,volume:this.volume,speaker:this.speaker,isHide:this.isHide};n=(0,a.ZF)(t)?new S(this.i,{media:t},r):new T(this.i,{streamView:t},r)}return this.vocalSourceMap.set(t,n),n},n.prototype.setStreamVocalRange=function(t,i){var n=(0,a.ZF)(t);if(!n&&!(null==t?void 0:t.v))throw new Error("Failed to execute 'setVocalRange': type of parameter 1 error.");if(!G(i))throw Error("Failed to execute 'setVocalRange': parameter 2 requires to be type number.");i=Number(i),this.i.info(B+" ".concat(n?"custom":"stream"," set range: ")+i);var r=this.getVocalSource(t,i);r.setMaxDistance(i),r.checkIfCanPlay(this.h)},n.prototype.updateStreamPosition=function(t,i){if(!(0,a.ZF)(t)&&!(null==t?void 0:t.v))throw new Error("Failed to execute 'updatePosition': type of parameter 1 error.");if(!H(i))throw new Error("Failed to execute 'updatePosition': parameter 'position' must be an array of type number.");var n=this.getVocalSource(t);n.setPosition(i),n.checkIfCanPlay(this.h)},n.prototype.isOpen3D=function(i){return i instanceof b?(!(this.h.recvMode!==t.BI.World)||!i.isSpeakInTeam(this.h.teamID))&&this.isSpatial:this.isSpatial},n}(),Y=function(t,i,n,r){return new(n||(n=Promise))((function(e,s){function o(t){try{h(r.next(t))}catch(t){s(t)}}function u(t){try{h(r.throw(t))}catch(t){s(t)}}function h(t){var i;t.done?e(t.value):(i=t.value,i instanceof n?i:new n((function(t){t(i)}))).then(o,u)}h((r=r.apply(t,i||[])).next())}))},Z=function(t,i){var n,r,e,s,o={label:0,sent:function(){if(1&e[0])throw e[1];return e[1]},trys:[],ops:[]};return s={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function u(u){return function(h){return function(u){if(n)throw new TypeError("Generator is already executing.");for(;s&&(s=0,u[0]&&(o=0)),o;)try{if(n=1,r&&(e=2&u[0]?r.return:u[0]?r.throw||((e=r.return)&&e.call(r),0):r.next)&&!(e=e.call(r,u[1])).done)return e;switch(r=0,e&&(u=[2&u[0],e.value]),u[0]){case 0:case 1:e=u;break;case 4:return o.label++,{value:u[1],done:!1};case 5:o.label++,r=u[1],u=[0];continue;case 7:u=o.ops.pop(),o.trys.pop();continue;default:if(!(e=o.trys,(e=e.length>0&&e[e.length-1])||6!==u[0]&&2!==u[0])){o=0;continue}if(3===u[0]&&(!e||u[1]>e[0]&&u[1]<e[3])){o.label=u[1];break}if(6===u[0]&&o.label<e[1]){o.label=e[1],e=u;break}if(e&&o.label<e[2]){o.label=e[2],o.ops.push(u);break}e[2]&&o.ops.pop(),o.trys.pop();continue}u=i.call(t,o)}catch(t){u=[6,t],r=0}finally{n=e=0}if(5&u[0])throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}([u,h])}}},K=function(){function t(t,i){this.m=Q.getInstance(t,i)}return t.getInstance=function(i,n){if(!t.instance){if(!i)throw Error("create instance failed.");t.instance=new t(i,n)}return t.instance},t.prototype.enableAiDenoise=function(t){return this.m.enableAiDenoise(t)},t.prototype.setAiDenoiseMode=function(t){return this.m.setAiDenoiseMode(t)},t.prototype.enableAudioSourceUpdateChecker=function(t,i){this.m.enableAudioSourceUpdateChecker(t,i)},t.prototype.on=function(t,i){return this.m.on(t,i)},t.prototype.off=function(t,i){return this.m.off(t,i)},t.prototype.setAudioReceiveRange=function(t){this.m.setAudioReceiveRange(t)},t.prototype.updateSelfPosition=function(t,i,n,r){this.m.updateSelfPosition(t,i,n,r)},t.prototype.updateAudioSource=function(t,i){this.m.updateAudioSource(t,i)},t.prototype.enableSpatializer=function(t){return this.m.enableSpatializer(t)},t.prototype.enableMicrophone=function(t){return this.m.enableMicrophone(t)},t.prototype.selectMicrophone=function(t){return Y(this,void 0,void 0,(function(){return Z(this,(function(i){switch(i.label){case 0:return[4,this.m.selectMic(t)];case 1:return[2,i.sent()]}}))}))},t.prototype.selectSpeaker=function(t){return this.m.selectSpeaker(t)},t.prototype.enableSpeaker=function(t){return this.m.enableSpeaker(t)},t.prototype.setRangeAudioCustomMode=function(t,i){this.m.setCustomMode(t,i)},t.prototype.setRangeAudioMode=function(t){this.m.setRangeAudioMode(t)},t.prototype.setTeamID=function(t){this.m.setRangeAudioTeamID(t)},t.prototype.setPositionUpdateFrequency=function(t){return this.m.setPositionUpdateFrequency(t)},t.prototype.setRangeAudioVolume=function(t){return this.m.setAudioVolume(t)},t.prototype.setVoiceChangerPreset=function(t){return this.m.setVoiceChangerPreset({voiceChanger:t})},t.prototype.setVoiceChangerParam=function(t){return this.m.setVoiceChangerPreset({voiceParam:t})},t.prototype.isAudioContextRunning=function(){return"running"===this.m.getAudioContextState()},t.prototype.resumeAudioContext=function(){return this.m.resumeAudioContext()},t.prototype.setStreamVocalRange=function(t,i){this.m.setStreamVocalRange(t,i)},t.prototype.updateStreamPosition=function(t,i){this.m.updateStreamPosition(t,i)},t.prototype.setCustomSourceVocalRange=function(t,i){this.m.setStreamVocalRange(t,i)},t.prototype.updateCustomSourcePosition=function(t,i){this.m.updateStreamPosition(t,i)},t}(),$={type:"RangeAudio",install:function(t){Object.defineProperty(t.prototype,"createRangeAudioInstance",{value:function(){return this.rangeAudio||(this.rangeAudio=K.getInstance(this,this.logger)),this.rangeAudio},writable:!1})}}}(),r}()}));